{
    "sourceFile": "CH579EVT/EVT/EXAM/USB/Device/CH579EVT_USB_DISK_TEST/BLE/ch57x_ble_uart_mrs_app_only_test/hal/hal_device.c",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 106,
            "patches": [
                {
                    "date": 1677078341030,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1677078379565,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -108,12 +108,13 @@\n         return dev->dops->config(dev, args, var);\r\n \r\n     return HAL_ERROR;\r\n }\r\n+\r\n /*\r\n     驱动配置\r\n */\r\n-int hal_device_cfg(hal_device_t *dev, void *args, void *var)\r\n+int hal_device_init(hal_device_t *dev, void *args, void *var)\r\n {\r\n     HAL_DEV_NULL_CHECK(dev);\r\n \r\n     if(dev->dops->config)\r\n"
                },
                {
                    "date": 1677078429418,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -112,9 +112,9 @@\n \r\n /*\r\n     驱动配置\r\n */\r\n-int hal_device_init(hal_device_t *dev, void *args, void *var)\r\n+int hal_device_init(hal_device_t *dev);\r\n {\r\n     HAL_DEV_NULL_CHECK(dev);\r\n \r\n     if(dev->dops->config)\r\n"
                },
                {
                    "date": 1677078436531,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -117,9 +117,9 @@\n {\r\n     HAL_DEV_NULL_CHECK(dev);\r\n \r\n     if(dev->dops->config)\r\n-        return dev->dops->config(dev, args, var);\r\n+        return dev->dops->config(dev);\r\n \r\n     return HAL_ERROR;\r\n }\r\n /*\r\n"
                },
                {
                    "date": 1677078447376,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -112,14 +112,14 @@\n \r\n /*\r\n     驱动配置\r\n */\r\n-int hal_device_init(hal_device_t *dev);\r\n+int hal_device_init(hal_device_t *dev)\r\n {\r\n     HAL_DEV_NULL_CHECK(dev);\r\n \r\n     if(dev->dops->config)\r\n-        return dev->dops->config(dev);\r\n+        return dev->dops->init(dev);\r\n \r\n     return HAL_ERROR;\r\n }\r\n /*\r\n"
                },
                {
                    "date": 1677078455469,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,133 @@\n+#include \"hal_device.h\"\r\n+#include <string.h>\r\n+\r\n+hal_device_t *hdev_list = NULL;\r\n+\r\n+// 查找设备是否存在\r\n+static int hal_device_is_exists(hal_device_t *dev)\r\n+{\r\n+    HAL_DEV_NULL_CHECK(dev);\r\n+    hal_device_t *cur = hdev_list;\r\n+    while (NULL != cur)\r\n+    {\r\n+        if(stecmp(cur->name, dev->name) == 0)\r\n+            return HAL_ERROR;\r\n+        cur = cur->next;\r\n+    }\r\n+    return HAL_OK;\r\n+}\r\n+\r\n+// 插入设备\r\n+static int hal_device_inster(hal_device_t *dev)\r\n+{\r\n+    hal_device_t *cur = hdev_list;\r\n+    if( NULL == dev )\r\n+        return HAL_ERROR;\r\n+    if(NULL == cur)\r\n+    {\r\n+        hdev_list = dev;\r\n+        hdev_list->next = NULL;\r\n+    }else\r\n+    {\r\n+        while(NULL != cur)\r\n+            cur = cur->next;\r\n+        cur->next = dev;\r\n+        dev->next = NULL;\r\n+    }\r\n+    return HAL_OK;\r\n+}\r\n+\r\n+// 驱动注册\r\n+int hal_device_register(hal_device_t *dev)\r\n+{\r\n+    HAL_DEV_NULL_CHECK(dev);\r\n+\r\n+    if((NULL==dev->name) || (NULL==dev->dops) || (hal_device_is_exists(dev)==HAL_ERROR))\r\n+    {\r\n+        return HAL_ERROR;\r\n+    }\r\n+    return hal_device_inster(dev);\r\n+}\r\n+\r\n+hal_device_t *hal_device_find(const char *name)\r\n+{\r\n+    HAL_DEV_NULL_CHECK(name);\r\n+    hal_device_t *cur = hdev_list;\r\n+    while (NULL != cur)\r\n+    {\r\n+        if(strcmp(cur->name, name) == 0)\r\n+            return cur;\r\n+        cur = cur->next;\r\n+    }\r\n+    return NULL;\r\n+}\r\n+\r\n+\r\n+/*\r\n+    驱动读\r\n+*/\r\n+int hal_device_read(hal_device_t *dev,  int pos, void *buffer, int size)\r\n+{\r\n+    HAL_DEV_NULL_CHECK(dev);\r\n+\r\n+    if(dev->dops->read)\r\n+        return dev->dops->read(dev, pos, buffer, size);\r\n+\r\n+    return HAL_ERROR;\r\n+}\r\n+/*\r\n+    驱动写\r\n+*/\r\n+int hal_device_write(hal_device_t *dev, int pos, const void *buffer, int size)\r\n+{\r\n+    HAL_DEV_NULL_CHECK(dev);\r\n+    if(dev->dops->write)\r\n+        return dev->dops->write(dev, pos, buffer, size);\r\n+\r\n+    return HAL_ERROR;\r\n+}\r\n+/*\r\n+    驱动控制\r\n+*/\r\n+int hal_device_ctrl(hal_device_t *dev,  int cmd, void *arg)\r\n+{\r\n+    HAL_DEV_NULL_CHECK(dev);\r\n+    if(dev->dops->control)\r\n+        return dev->dops->control(dev, cmd, arg);\r\n+\r\n+    return HAL_ERROR;\r\n+}\r\n+/*\r\n+    驱动配置\r\n+*/\r\n+int hal_device_cfg(hal_device_t *dev, void *args, void *var)\r\n+{\r\n+    HAL_DEV_NULL_CHECK(dev);\r\n+\r\n+    if(dev->dops->config)\r\n+        return dev->dops->config(dev, args, var);\r\n+\r\n+    return HAL_ERROR;\r\n+}\r\n+\r\n+/*\r\n+    驱动初始化\r\n+*/\r\n+int hal_device_init(hal_device_t *dev)\r\n+{\r\n+    HAL_DEV_NULL_CHECK(dev);\r\n+\r\n+    if(dev->dops->config)\r\n+        return dev->dops->init(dev);\r\n+\r\n+    return HAL_ERROR;\r\n+}\r\n+/*\r\n+    设置驱动属于哪个任务\r\n+*/\r\n+void hal_device_set_owner(hal_device_t *dev, const void *owner)\r\n+{\r\n+    dev->owner = (void *)owner;\r\n+}\r\n+\r\n+\r\n"
                },
                {
                    "date": 1677078662113,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -9,9 +9,9 @@\n     HAL_DEV_NULL_CHECK(dev);\r\n     hal_device_t *cur = hdev_list;\r\n     while (NULL != cur)\r\n     {\r\n-        if(stecmp(cur->name, dev->name) == 0)\r\n+        if(strcmp(cur->name, dev->name) == 0)\r\n             return HAL_ERROR;\r\n         cur = cur->next;\r\n     }\r\n     return HAL_OK;\r\n@@ -130,137 +130,4 @@\n     dev->owner = (void *)owner;\r\n }\r\n \r\n \r\n-#include \"hal_device.h\"\r\n-#include <string.h>\r\n-\r\n-hal_device_t *hdev_list = NULL;\r\n-\r\n-// 查找设备是否存在\r\n-static int hal_device_is_exists(hal_device_t *dev)\r\n-{\r\n-    HAL_DEV_NULL_CHECK(dev);\r\n-    hal_device_t *cur = hdev_list;\r\n-    while (NULL != cur)\r\n-    {\r\n-        if(stecmp(cur->name, dev->name) == 0)\r\n-            return HAL_ERROR;\r\n-        cur = cur->next;\r\n-    }\r\n-    return HAL_OK;\r\n-}\r\n-\r\n-// 插入设备\r\n-static int hal_device_inster(hal_device_t *dev)\r\n-{\r\n-    hal_device_t *cur = hdev_list;\r\n-    if( NULL == dev )\r\n-        return HAL_ERROR;\r\n-    if(NULL == cur)\r\n-    {\r\n-        hdev_list = dev;\r\n-        hdev_list->next = NULL;\r\n-    }else\r\n-    {\r\n-        while(NULL != cur)\r\n-            cur = cur->next;\r\n-        cur->next = dev;\r\n-        dev->next = NULL;\r\n-    }\r\n-    return HAL_OK;\r\n-}\r\n-\r\n-// 驱动注册\r\n-int hal_device_register(hal_device_t *dev)\r\n-{\r\n-    HAL_DEV_NULL_CHECK(dev);\r\n-\r\n-    if((NULL==dev->name) || (NULL==dev->dops) || (hal_device_is_exists(dev)==HAL_ERROR))\r\n-    {\r\n-        return HAL_ERROR;\r\n-    }\r\n-    return hal_device_inster(dev);\r\n-}\r\n-\r\n-hal_device_t *hal_device_find(const char *name)\r\n-{\r\n-    HAL_DEV_NULL_CHECK(name);\r\n-    hal_device_t *cur = hdev_list;\r\n-    while (NULL != cur)\r\n-    {\r\n-        if(strcmp(cur->name, name) == 0)\r\n-            return cur;\r\n-        cur = cur->next;\r\n-    }\r\n-    return NULL;\r\n-}\r\n-\r\n-\r\n-/*\r\n-    驱动读\r\n-*/\r\n-int hal_device_read(hal_device_t *dev,  int pos, void *buffer, int size)\r\n-{\r\n-    HAL_DEV_NULL_CHECK(dev);\r\n-\r\n-    if(dev->dops->read)\r\n-        return dev->dops->read(dev, pos, buffer, size);\r\n-\r\n-    return HAL_ERROR;\r\n-}\r\n-/*\r\n-    驱动写\r\n-*/\r\n-int hal_device_write(hal_device_t *dev, int pos, const void *buffer, int size)\r\n-{\r\n-    HAL_DEV_NULL_CHECK(dev);\r\n-    if(dev->dops->write)\r\n-        return dev->dops->write(dev, pos, buffer, size);\r\n-\r\n-    return HAL_ERROR;\r\n-}\r\n-/*\r\n-    驱动控制\r\n-*/\r\n-int hal_device_ctrl(hal_device_t *dev,  int cmd, void *arg)\r\n-{\r\n-    HAL_DEV_NULL_CHECK(dev);\r\n-    if(dev->dops->control)\r\n-        return dev->dops->control(dev, cmd, arg);\r\n-\r\n-    return HAL_ERROR;\r\n-}\r\n-/*\r\n-    驱动配置\r\n-*/\r\n-int hal_device_cfg(hal_device_t *dev, void *args, void *var)\r\n-{\r\n-    HAL_DEV_NULL_CHECK(dev);\r\n-\r\n-    if(dev->dops->config)\r\n-        return dev->dops->config(dev, args, var);\r\n-\r\n-    return HAL_ERROR;\r\n-}\r\n-\r\n-/*\r\n-    驱动配置\r\n-*/\r\n-int hal_device_init(hal_device_t *dev)\r\n-{\r\n-    HAL_DEV_NULL_CHECK(dev);\r\n-\r\n-    if(dev->dops->config)\r\n-        return dev->dops->init(dev);\r\n-\r\n-    return HAL_ERROR;\r\n-}\r\n-/*\r\n-    设置驱动属于哪个任务\r\n-*/\r\n-void hal_device_set_owner(hal_device_t *dev, const void *owner)\r\n-{\r\n-    dev->owner = (void *)owner;\r\n-}\r\n-\r\n-\r\n"
                },
                {
                    "date": 1677079140992,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -116,9 +116,9 @@\n int hal_device_init(hal_device_t *dev)\r\n {\r\n     HAL_DEV_NULL_CHECK(dev);\r\n \r\n-    if(dev->dops->config)\r\n+    if(dev->dops->init)\r\n         return dev->dops->init(dev);\r\n \r\n     return HAL_ERROR;\r\n }\r\n"
                },
                {
                    "date": 1677079147530,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -115,8 +115,9 @@\n */\r\n int hal_device_init(hal_device_t *dev)\r\n {\r\n     HAL_DEV_NULL_CHECK(dev);\r\n+    HAL_DEV_NULL_CHECK(dev->dops->init);\r\n \r\n     if(dev->dops->init)\r\n         return dev->dops->init(dev);\r\n \r\n"
                },
                {
                    "date": 1677079156771,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -115,9 +115,8 @@\n */\r\n int hal_device_init(hal_device_t *dev)\r\n {\r\n     HAL_DEV_NULL_CHECK(dev);\r\n-    HAL_DEV_NULL_CHECK(dev->dops->init);\r\n \r\n     if(dev->dops->init)\r\n         return dev->dops->init(dev);\r\n \r\n"
                },
                {
                    "date": 1677079366834,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -39,9 +39,9 @@\n \r\n // 驱动注册\r\n int hal_device_register(hal_device_t *dev)\r\n {\r\n-    HAL_DEV_NULL_CHECK(dev);\r\n+    // HAL_DEV_NULL_CHECK(dev);\r\n \r\n     if((NULL==dev->name) || (NULL==dev->dops) || (hal_device_is_exists(dev)==HAL_ERROR))\r\n     {\r\n         return HAL_ERROR;\r\n"
                },
                {
                    "date": 1677079397459,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -24,9 +24,9 @@\n     if( NULL == dev )\r\n         return HAL_ERROR;\r\n     if(NULL == cur)\r\n     {\r\n-        hdev_list = dev;\r\n+        cur = dev;\r\n         hdev_list->next = NULL;\r\n     }else\r\n     {\r\n         while(NULL != cur)\r\n"
                },
                {
                    "date": 1677079446325,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -24,9 +24,9 @@\n     if( NULL == dev )\r\n         return HAL_ERROR;\r\n     if(NULL == cur)\r\n     {\r\n-        cur = dev;\r\n+        hdev_list = dev;\r\n         hdev_list->next = NULL;\r\n     }else\r\n     {\r\n         while(NULL != cur)\r\n@@ -39,9 +39,9 @@\n \r\n // 驱动注册\r\n int hal_device_register(hal_device_t *dev)\r\n {\r\n-    // HAL_DEV_NULL_CHECK(dev);\r\n+    HAL_DEV_NULL_CHECK(dev);\r\n \r\n     if((NULL==dev->name) || (NULL==dev->dops) || (hal_device_is_exists(dev)==HAL_ERROR))\r\n     {\r\n         return HAL_ERROR;\r\n"
                },
                {
                    "date": 1677079459686,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -24,10 +24,10 @@\n     if( NULL == dev )\r\n         return HAL_ERROR;\r\n     if(NULL == cur)\r\n     {\r\n-        hdev_list = dev;\r\n-        hdev_list->next = NULL;\r\n+        cur = dev;\r\n+        cur->next = NULL;\r\n     }else\r\n     {\r\n         while(NULL != cur)\r\n             cur = cur->next;\r\n"
                },
                {
                    "date": 1677079838567,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -114,9 +114,9 @@\n     驱动初始化\r\n */\r\n int hal_device_init(hal_device_t *dev)\r\n {\r\n-    HAL_DEV_NULL_CHECK(dev);\r\n+    // HAL_DEV_NULL_CHECK(dev);\r\n \r\n     if(dev->dops->init)\r\n         return dev->dops->init(dev);\r\n \r\n"
                },
                {
                    "date": 1677079865539,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -114,9 +114,9 @@\n     驱动初始化\r\n */\r\n int hal_device_init(hal_device_t *dev)\r\n {\r\n-    // HAL_DEV_NULL_CHECK(dev);\r\n+    HAL_DEV_NULL_CHECK(dev);\r\n \r\n     if(dev->dops->init)\r\n         return dev->dops->init(dev);\r\n \r\n"
                },
                {
                    "date": 1677080337899,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -52,8 +52,9 @@\n hal_device_t *hal_device_find(const char *name)\r\n {\r\n     HAL_DEV_NULL_CHECK(name);\r\n     hal_device_t *cur = hdev_list;\r\n+    LOG_\r\n     while (NULL != cur)\r\n     {\r\n         if(strcmp(cur->name, name) == 0)\r\n             return cur;\r\n"
                },
                {
                    "date": 1677080343105,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -52,9 +52,9 @@\n hal_device_t *hal_device_find(const char *name)\r\n {\r\n     HAL_DEV_NULL_CHECK(name);\r\n     hal_device_t *cur = hdev_list;\r\n-    LOG_\r\n+    LOG_DEBUG();\r\n     while (NULL != cur)\r\n     {\r\n         if(strcmp(cur->name, name) == 0)\r\n             return cur;\r\n"
                },
                {
                    "date": 1677080354169,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -51,10 +51,11 @@\n \r\n hal_device_t *hal_device_find(const char *name)\r\n {\r\n     HAL_DEV_NULL_CHECK(name);\r\n+    LOG_DEBUG(\"find : %s\\r\\n\");\r\n     hal_device_t *cur = hdev_list;\r\n-    LOG_DEBUG();\r\n+    LOG_DEBUG(\"find : %s\\r\\n\");\r\n     while (NULL != cur)\r\n     {\r\n         if(strcmp(cur->name, name) == 0)\r\n             return cur;\r\n"
                },
                {
                    "date": 1677080385192,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -51,14 +51,14 @@\n \r\n hal_device_t *hal_device_find(const char *name)\r\n {\r\n     HAL_DEV_NULL_CHECK(name);\r\n-    LOG_DEBUG(\"find : %s\\r\\n\");\r\n+    LOG_DEBUG(\"find : %s\\r\\n\", name);\r\n     hal_device_t *cur = hdev_list;\r\n-    LOG_DEBUG(\"find : %s\\r\\n\");\r\n     while (NULL != cur)\r\n     {\r\n         if(strcmp(cur->name, name) == 0)\r\n+    LOG_DEBUG(\"find : %s\\r\\n\");\r\n             return cur;\r\n         cur = cur->next;\r\n     }\r\n     return NULL;\r\n"
                },
                {
                    "date": 1677080390917,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -56,9 +56,12 @@\n     hal_device_t *cur = hdev_list;\r\n     while (NULL != cur)\r\n     {\r\n         if(strcmp(cur->name, name) == 0)\r\n-    LOG_DEBUG(\"find : %s\\r\\n\");\r\n+        {\r\n+        LOG_DEBUG(\"find : %s\\r\\n\");\r\n+\r\n+        }\r\n             return cur;\r\n         cur = cur->next;\r\n     }\r\n     return NULL;\r\n"
                },
                {
                    "date": 1677080397227,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -57,10 +57,9 @@\n     while (NULL != cur)\r\n     {\r\n         if(strcmp(cur->name, name) == 0)\r\n         {\r\n-        LOG_DEBUG(\"find : %s\\r\\n\");\r\n-\r\n+            LOG_DEBUG(\"===\\r\\n\");\r\n         }\r\n             return cur;\r\n         cur = cur->next;\r\n     }\r\n"
                },
                {
                    "date": 1677080438036,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -41,8 +41,10 @@\n int hal_device_register(hal_device_t *dev)\r\n {\r\n     HAL_DEV_NULL_CHECK(dev);\r\n \r\n+    \r\n+\r\n     if((NULL==dev->name) || (NULL==dev->dops) || (hal_device_is_exists(dev)==HAL_ERROR))\r\n     {\r\n         return HAL_ERROR;\r\n     }\r\n@@ -58,10 +60,10 @@\n     {\r\n         if(strcmp(cur->name, name) == 0)\r\n         {\r\n             LOG_DEBUG(\"===\\r\\n\");\r\n+            return cur;\r\n         }\r\n-            return cur;\r\n         cur = cur->next;\r\n     }\r\n     return NULL;\r\n }\r\n"
                },
                {
                    "date": 1677080446573,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -41,9 +41,9 @@\n int hal_device_register(hal_device_t *dev)\r\n {\r\n     HAL_DEV_NULL_CHECK(dev);\r\n \r\n-    \r\n+    LOG_DEBUG(\"register : %s\\r\\n\", name);\r\n \r\n     if((NULL==dev->name) || (NULL==dev->dops) || (hal_device_is_exists(dev)==HAL_ERROR))\r\n     {\r\n         return HAL_ERROR;\r\n"
                },
                {
                    "date": 1677080451617,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -41,9 +41,9 @@\n int hal_device_register(hal_device_t *dev)\r\n {\r\n     HAL_DEV_NULL_CHECK(dev);\r\n \r\n-    LOG_DEBUG(\"register : %s\\r\\n\", name);\r\n+    LOG_DEBUG(\"register : %s\\r\\n\", dev->name);\r\n \r\n     if((NULL==dev->name) || (NULL==dev->dops) || (hal_device_is_exists(dev)==HAL_ERROR))\r\n     {\r\n         return HAL_ERROR;\r\n"
                },
                {
                    "date": 1677080772861,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -57,8 +57,9 @@\n     LOG_DEBUG(\"find : %s\\r\\n\", name);\r\n     hal_device_t *cur = hdev_list;\r\n     while (NULL != cur)\r\n     {\r\n+        LOG_\r\n         if(strcmp(cur->name, name) == 0)\r\n         {\r\n             LOG_DEBUG(\"===\\r\\n\");\r\n             return cur;\r\n"
                },
                {
                    "date": 1677080779523,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,140 @@\n+#include \"hal_device.h\"\r\n+#include <string.h>\r\n+\r\n+hal_device_t *hdev_list = NULL;\r\n+\r\n+// 查找设备是否存在\r\n+static int hal_device_is_exists(hal_device_t *dev)\r\n+{\r\n+    HAL_DEV_NULL_CHECK(dev);\r\n+    hal_device_t *cur = hdev_list;\r\n+    while (NULL != cur)\r\n+    {\r\n+        if(strcmp(cur->name, dev->name) == 0)\r\n+            return HAL_ERROR;\r\n+        cur = cur->next;\r\n+    }\r\n+    return HAL_OK;\r\n+}\r\n+\r\n+// 插入设备\r\n+static int hal_device_inster(hal_device_t *dev)\r\n+{\r\n+    hal_device_t *cur = hdev_list;\r\n+    if( NULL == dev )\r\n+        return HAL_ERROR;\r\n+    if(NULL == cur)\r\n+    {\r\n+        cur = dev;\r\n+        cur->next = NULL;\r\n+    }else\r\n+    {\r\n+        while(NULL != cur)\r\n+            cur = cur->next;\r\n+        cur->next = dev;\r\n+        dev->next = NULL;\r\n+    }\r\n+    return HAL_OK;\r\n+}\r\n+\r\n+// 驱动注册\r\n+int hal_device_register(hal_device_t *dev)\r\n+{\r\n+    HAL_DEV_NULL_CHECK(dev);\r\n+\r\n+    LOG_DEBUG(\"register : %s\\r\\n\", dev->name);\r\n+\r\n+    if((NULL==dev->name) || (NULL==dev->dops) || (hal_device_is_exists(dev)==HAL_ERROR))\r\n+    {\r\n+        return HAL_ERROR;\r\n+    }\r\n+    return hal_device_inster(dev);\r\n+}\r\n+\r\n+hal_device_t *hal_device_find(const char *name)\r\n+{\r\n+    HAL_DEV_NULL_CHECK(name);\r\n+    LOG_DEBUG(\"find : %s\\r\\n\", name);\r\n+    hal_device_t *cur = hdev_list;\r\n+    while (NULL != cur)\r\n+    {\r\n+        LOG_DEBUG(\"  \");\r\n+        if(strcmp(cur->name, name) == 0)\r\n+        {\r\n+            LOG_DEBUG(\"===\\r\\n\");\r\n+            return cur;\r\n+        }\r\n+        cur = cur->next;\r\n+    }\r\n+    return NULL;\r\n+}\r\n+\r\n+\r\n+/*\r\n+    驱动读\r\n+*/\r\n+int hal_device_read(hal_device_t *dev,  int pos, void *buffer, int size)\r\n+{\r\n+    HAL_DEV_NULL_CHECK(dev);\r\n+\r\n+    if(dev->dops->read)\r\n+        return dev->dops->read(dev, pos, buffer, size);\r\n+\r\n+    return HAL_ERROR;\r\n+}\r\n+/*\r\n+    驱动写\r\n+*/\r\n+int hal_device_write(hal_device_t *dev, int pos, const void *buffer, int size)\r\n+{\r\n+    HAL_DEV_NULL_CHECK(dev);\r\n+    if(dev->dops->write)\r\n+        return dev->dops->write(dev, pos, buffer, size);\r\n+\r\n+    return HAL_ERROR;\r\n+}\r\n+/*\r\n+    驱动控制\r\n+*/\r\n+int hal_device_ctrl(hal_device_t *dev,  int cmd, void *arg)\r\n+{\r\n+    HAL_DEV_NULL_CHECK(dev);\r\n+    if(dev->dops->control)\r\n+        return dev->dops->control(dev, cmd, arg);\r\n+\r\n+    return HAL_ERROR;\r\n+}\r\n+/*\r\n+    驱动配置\r\n+*/\r\n+int hal_device_cfg(hal_device_t *dev, void *args, void *var)\r\n+{\r\n+    HAL_DEV_NULL_CHECK(dev);\r\n+\r\n+    if(dev->dops->config)\r\n+        return dev->dops->config(dev, args, var);\r\n+\r\n+    return HAL_ERROR;\r\n+}\r\n+\r\n+/*\r\n+    驱动初始化\r\n+*/\r\n+int hal_device_init(hal_device_t *dev)\r\n+{\r\n+    HAL_DEV_NULL_CHECK(dev);\r\n+\r\n+    if(dev->dops->init)\r\n+        return dev->dops->init(dev);\r\n+\r\n+    return HAL_ERROR;\r\n+}\r\n+/*\r\n+    设置驱动属于哪个任务\r\n+*/\r\n+void hal_device_set_owner(hal_device_t *dev, const void *owner)\r\n+{\r\n+    dev->owner = (void *)owner;\r\n+}\r\n+\r\n+\r\n"
                },
                {
                    "date": 1677080790665,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -57,9 +57,9 @@\n     LOG_DEBUG(\"find : %s\\r\\n\", name);\r\n     hal_device_t *cur = hdev_list;\r\n     while (NULL != cur)\r\n     {\r\n-        LOG_DEBUG(\"  \");\r\n+        LOG_DEBUG(\" |%s| |%s| \");\r\n         if(strcmp(cur->name, name) == 0)\r\n         {\r\n             LOG_DEBUG(\"===\\r\\n\");\r\n             return cur;\r\n@@ -137,144 +137,4 @@\n     dev->owner = (void *)owner;\r\n }\r\n \r\n \r\n-#include \"hal_device.h\"\r\n-#include <string.h>\r\n-\r\n-hal_device_t *hdev_list = NULL;\r\n-\r\n-// 查找设备是否存在\r\n-static int hal_device_is_exists(hal_device_t *dev)\r\n-{\r\n-    HAL_DEV_NULL_CHECK(dev);\r\n-    hal_device_t *cur = hdev_list;\r\n-    while (NULL != cur)\r\n-    {\r\n-        if(strcmp(cur->name, dev->name) == 0)\r\n-            return HAL_ERROR;\r\n-        cur = cur->next;\r\n-    }\r\n-    return HAL_OK;\r\n-}\r\n-\r\n-// 插入设备\r\n-static int hal_device_inster(hal_device_t *dev)\r\n-{\r\n-    hal_device_t *cur = hdev_list;\r\n-    if( NULL == dev )\r\n-        return HAL_ERROR;\r\n-    if(NULL == cur)\r\n-    {\r\n-        cur = dev;\r\n-        cur->next = NULL;\r\n-    }else\r\n-    {\r\n-        while(NULL != cur)\r\n-            cur = cur->next;\r\n-        cur->next = dev;\r\n-        dev->next = NULL;\r\n-    }\r\n-    return HAL_OK;\r\n-}\r\n-\r\n-// 驱动注册\r\n-int hal_device_register(hal_device_t *dev)\r\n-{\r\n-    HAL_DEV_NULL_CHECK(dev);\r\n-\r\n-    LOG_DEBUG(\"register : %s\\r\\n\", dev->name);\r\n-\r\n-    if((NULL==dev->name) || (NULL==dev->dops) || (hal_device_is_exists(dev)==HAL_ERROR))\r\n-    {\r\n-        return HAL_ERROR;\r\n-    }\r\n-    return hal_device_inster(dev);\r\n-}\r\n-\r\n-hal_device_t *hal_device_find(const char *name)\r\n-{\r\n-    HAL_DEV_NULL_CHECK(name);\r\n-    LOG_DEBUG(\"find : %s\\r\\n\", name);\r\n-    hal_device_t *cur = hdev_list;\r\n-    while (NULL != cur)\r\n-    {\r\n-        LOG_\r\n-        if(strcmp(cur->name, name) == 0)\r\n-        {\r\n-            LOG_DEBUG(\"===\\r\\n\");\r\n-            return cur;\r\n-        }\r\n-        cur = cur->next;\r\n-    }\r\n-    return NULL;\r\n-}\r\n-\r\n-\r\n-/*\r\n-    驱动读\r\n-*/\r\n-int hal_device_read(hal_device_t *dev,  int pos, void *buffer, int size)\r\n-{\r\n-    HAL_DEV_NULL_CHECK(dev);\r\n-\r\n-    if(dev->dops->read)\r\n-        return dev->dops->read(dev, pos, buffer, size);\r\n-\r\n-    return HAL_ERROR;\r\n-}\r\n-/*\r\n-    驱动写\r\n-*/\r\n-int hal_device_write(hal_device_t *dev, int pos, const void *buffer, int size)\r\n-{\r\n-    HAL_DEV_NULL_CHECK(dev);\r\n-    if(dev->dops->write)\r\n-        return dev->dops->write(dev, pos, buffer, size);\r\n-\r\n-    return HAL_ERROR;\r\n-}\r\n-/*\r\n-    驱动控制\r\n-*/\r\n-int hal_device_ctrl(hal_device_t *dev,  int cmd, void *arg)\r\n-{\r\n-    HAL_DEV_NULL_CHECK(dev);\r\n-    if(dev->dops->control)\r\n-        return dev->dops->control(dev, cmd, arg);\r\n-\r\n-    return HAL_ERROR;\r\n-}\r\n-/*\r\n-    驱动配置\r\n-*/\r\n-int hal_device_cfg(hal_device_t *dev, void *args, void *var)\r\n-{\r\n-    HAL_DEV_NULL_CHECK(dev);\r\n-\r\n-    if(dev->dops->config)\r\n-        return dev->dops->config(dev, args, var);\r\n-\r\n-    return HAL_ERROR;\r\n-}\r\n-\r\n-/*\r\n-    驱动初始化\r\n-*/\r\n-int hal_device_init(hal_device_t *dev)\r\n-{\r\n-    HAL_DEV_NULL_CHECK(dev);\r\n-\r\n-    if(dev->dops->init)\r\n-        return dev->dops->init(dev);\r\n-\r\n-    return HAL_ERROR;\r\n-}\r\n-/*\r\n-    设置驱动属于哪个任务\r\n-*/\r\n-void hal_device_set_owner(hal_device_t *dev, const void *owner)\r\n-{\r\n-    dev->owner = (void *)owner;\r\n-}\r\n-\r\n-\r\n"
                },
                {
                    "date": 1677080798165,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -57,9 +57,9 @@\n     LOG_DEBUG(\"find : %s\\r\\n\", name);\r\n     hal_device_t *cur = hdev_list;\r\n     while (NULL != cur)\r\n     {\r\n-        LOG_DEBUG(\" |%s| |%s| \");\r\n+        LOG_DEBUG(\"|%s| |%s|\\r\\n\", );\r\n         if(strcmp(cur->name, name) == 0)\r\n         {\r\n             LOG_DEBUG(\"===\\r\\n\");\r\n             return cur;\r\n"
                },
                {
                    "date": 1677080806583,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -57,9 +57,9 @@\n     LOG_DEBUG(\"find : %s\\r\\n\", name);\r\n     hal_device_t *cur = hdev_list;\r\n     while (NULL != cur)\r\n     {\r\n-        LOG_DEBUG(\"|%s| |%s|\\r\\n\", );\r\n+        LOG_DEBUG(\"|%s| |%s|\\r\\n\",cur->name name, );\r\n         if(strcmp(cur->name, name) == 0)\r\n         {\r\n             LOG_DEBUG(\"===\\r\\n\");\r\n             return cur;\r\n"
                },
                {
                    "date": 1677080812125,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -57,9 +57,9 @@\n     LOG_DEBUG(\"find : %s\\r\\n\", name);\r\n     hal_device_t *cur = hdev_list;\r\n     while (NULL != cur)\r\n     {\r\n-        LOG_DEBUG(\"|%s| |%s|\\r\\n\",cur->name name, );\r\n+        LOG_DEBUG(\"|%s| |%s|\\r\\n\",cur->name, name);\r\n         if(strcmp(cur->name, name) == 0)\r\n         {\r\n             LOG_DEBUG(\"===\\r\\n\");\r\n             return cur;\r\n"
                },
                {
                    "date": 1677080940892,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -43,12 +43,12 @@\n     HAL_DEV_NULL_CHECK(dev);\r\n \r\n     LOG_DEBUG(\"register : %s\\r\\n\", dev->name);\r\n \r\n-    if((NULL==dev->name) || (NULL==dev->dops) || (hal_device_is_exists(dev)==HAL_ERROR))\r\n-    {\r\n-        return HAL_ERROR;\r\n-    }\r\n+    // if((NULL==dev->name) || (NULL==dev->dops) || (hal_device_is_exists(dev)==HAL_ERROR))\r\n+    // {\r\n+    //     return HAL_ERROR;\r\n+    // }\r\n     return hal_device_inster(dev);\r\n }\r\n \r\n hal_device_t *hal_device_find(const char *name)\r\n"
                },
                {
                    "date": 1677081334517,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -25,8 +25,9 @@\n         return HAL_ERROR;\r\n     if(NULL == cur)\r\n     {\r\n         cur = dev;\r\n+        LOG_ERROR();\r\n         cur->next = NULL;\r\n     }else\r\n     {\r\n         while(NULL != cur)\r\n"
                },
                {
                    "date": 1677081339791,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -25,9 +25,9 @@\n         return HAL_ERROR;\r\n     if(NULL == cur)\r\n     {\r\n         cur = dev;\r\n-        LOG_ERROR();\r\n+        LOG_ERROR(\"%s\\r\\n\");\r\n         cur->next = NULL;\r\n     }else\r\n     {\r\n         while(NULL != cur)\r\n"
                },
                {
                    "date": 1677081345873,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -25,9 +25,9 @@\n         return HAL_ERROR;\r\n     if(NULL == cur)\r\n     {\r\n         cur = dev;\r\n-        LOG_ERROR(\"%s\\r\\n\");\r\n+        LOG_ERROR(\"%s\\r\\n\", cur.);\r\n         cur->next = NULL;\r\n     }else\r\n     {\r\n         while(NULL != cur)\r\n"
                },
                {
                    "date": 1677081352456,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -25,12 +25,13 @@\n         return HAL_ERROR;\r\n     if(NULL == cur)\r\n     {\r\n         cur = dev;\r\n-        LOG_ERROR(\"%s\\r\\n\", cur.);\r\n+        LOG_ERROR(\"%s\\r\\n\", cur->name);\r\n         cur->next = NULL;\r\n     }else\r\n     {\r\n+        LOG_ERROR(\"%s\\r\\n\", cur->name);\r\n         while(NULL != cur)\r\n             cur = cur->next;\r\n         cur->next = dev;\r\n         dev->next = NULL;\r\n"
                },
                {
                    "date": 1677081507007,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -29,13 +29,13 @@\n         LOG_ERROR(\"%s\\r\\n\", cur->name);\r\n         cur->next = NULL;\r\n     }else\r\n     {\r\n-        LOG_ERROR(\"%s\\r\\n\", cur->name);\r\n-        while(NULL != cur)\r\n+        while(NULL != cur.)\r\n             cur = cur->next;\r\n         cur->next = dev;\r\n         dev->next = NULL;\r\n+        LOG_ERROR(\"%s\\r\\n\", cur->name);\r\n     }\r\n     return HAL_OK;\r\n }\r\n \r\n"
                },
                {
                    "date": 1677081586764,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -5,9 +5,8 @@\n \r\n // 查找设备是否存在\r\n static int hal_device_is_exists(hal_device_t *dev)\r\n {\r\n-    HAL_DEV_NULL_CHECK(dev);\r\n     hal_device_t *cur = hdev_list;\r\n     while (NULL != cur)\r\n     {\r\n         if(strcmp(cur->name, dev->name) == 0)\r\n@@ -29,9 +28,9 @@\n         LOG_ERROR(\"%s\\r\\n\", cur->name);\r\n         cur->next = NULL;\r\n     }else\r\n     {\r\n-        while(NULL != cur.)\r\n+        while(NULL != cur->next)\r\n             cur = cur->next;\r\n         cur->next = dev;\r\n         dev->next = NULL;\r\n         LOG_ERROR(\"%s\\r\\n\", cur->name);\r\n"
                },
                {
                    "date": 1677081645421,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -23,9 +23,9 @@\n     if( NULL == dev )\r\n         return HAL_ERROR;\r\n     if(NULL == cur)\r\n     {\r\n-        cur = dev;\r\n+        hdev_list = dev;\r\n         LOG_ERROR(\"%s\\r\\n\", cur->name);\r\n         cur->next = NULL;\r\n     }else\r\n     {\r\n"
                },
                {
                    "date": 1677081742167,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -25,9 +25,9 @@\n     if(NULL == cur)\r\n     {\r\n         hdev_list = dev;\r\n         LOG_ERROR(\"%s\\r\\n\", cur->name);\r\n-        cur->next = NULL;\r\n+        dev->next = NULL;\r\n     }else\r\n     {\r\n         while(NULL != cur->next)\r\n             cur = cur->next;\r\n@@ -53,9 +53,8 @@\n }\r\n \r\n hal_device_t *hal_device_find(const char *name)\r\n {\r\n-    HAL_DEV_NULL_CHECK(name);\r\n     LOG_DEBUG(\"find : %s\\r\\n\", name);\r\n     hal_device_t *cur = hdev_list;\r\n     while (NULL != cur)\r\n     {\r\n"
                },
                {
                    "date": 1677081820278,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -23,9 +23,9 @@\n     if( NULL == dev )\r\n         return HAL_ERROR;\r\n     if(NULL == cur)\r\n     {\r\n-        hdev_list = dev;\r\n+        cur = dev;\r\n         LOG_ERROR(\"%s\\r\\n\", cur->name);\r\n         dev->next = NULL;\r\n     }else\r\n     {\r\n"
                },
                {
                    "date": 1677081900229,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -21,13 +21,13 @@\n {\r\n     hal_device_t *cur = hdev_list;\r\n     if( NULL == dev )\r\n         return HAL_ERROR;\r\n-    if(NULL == cur)\r\n+    if(NULL == hdev_list)\r\n     {\r\n         cur = dev;\r\n         LOG_ERROR(\"%s\\r\\n\", cur->name);\r\n-        dev->next = NULL;\r\n+        cur->next = NULL;\r\n     }else\r\n     {\r\n         while(NULL != cur->next)\r\n             cur = cur->next;\r\n"
                },
                {
                    "date": 1677081906344,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,140 @@\n+#include \"hal_device.h\"\r\n+#include <string.h>\r\n+\r\n+hal_device_t *hdev_list = NULL;\r\n+\r\n+// 查找设备是否存在\r\n+static int hal_device_is_exists(hal_device_t *dev)\r\n+{\r\n+    hal_device_t *cur = hdev_list;\r\n+    while (NULL != cur)\r\n+    {\r\n+        if(strcmp(cur->name, dev->name) == 0)\r\n+            return HAL_ERROR;\r\n+        cur = cur->next;\r\n+    }\r\n+    return HAL_OK;\r\n+}\r\n+\r\n+// 插入设备\r\n+static int hal_device_inster(hal_device_t *dev)\r\n+{\r\n+    hal_device_t *cur = hdev_list;\r\n+    if( NULL == dev )\r\n+        return HAL_ERROR;\r\n+    if(NULL == hdev_list)\r\n+    {\r\n+        hdev_list = dev;\r\n+        LOG_ERROR(\"%s\\r\\n\", cur->name);\r\n+        hdev_list->next = NULL;\r\n+    }else\r\n+    {\r\n+        while(NULL != cur->next)\r\n+            cur = cur->next;\r\n+        cur->next = dev;\r\n+        dev->next = NULL;\r\n+        LOG_ERROR(\"%s\\r\\n\", cur->name);\r\n+    }\r\n+    return HAL_OK;\r\n+}\r\n+\r\n+// 驱动注册\r\n+int hal_device_register(hal_device_t *dev)\r\n+{\r\n+    HAL_DEV_NULL_CHECK(dev);\r\n+\r\n+    LOG_DEBUG(\"register : %s\\r\\n\", dev->name);\r\n+\r\n+    // if((NULL==dev->name) || (NULL==dev->dops) || (hal_device_is_exists(dev)==HAL_ERROR))\r\n+    // {\r\n+    //     return HAL_ERROR;\r\n+    // }\r\n+    return hal_device_inster(dev);\r\n+}\r\n+\r\n+hal_device_t *hal_device_find(const char *name)\r\n+{\r\n+    LOG_DEBUG(\"find : %s\\r\\n\", name);\r\n+    hal_device_t *cur = hdev_list;\r\n+    while (NULL != cur)\r\n+    {\r\n+        LOG_DEBUG(\"|%s| |%s|\\r\\n\",cur->name, name);\r\n+        if(strcmp(cur->name, name) == 0)\r\n+        {\r\n+            LOG_DEBUG(\"===\\r\\n\");\r\n+            return cur;\r\n+        }\r\n+        cur = cur->next;\r\n+    }\r\n+    return NULL;\r\n+}\r\n+\r\n+\r\n+/*\r\n+    驱动读\r\n+*/\r\n+int hal_device_read(hal_device_t *dev,  int pos, void *buffer, int size)\r\n+{\r\n+    HAL_DEV_NULL_CHECK(dev);\r\n+\r\n+    if(dev->dops->read)\r\n+        return dev->dops->read(dev, pos, buffer, size);\r\n+\r\n+    return HAL_ERROR;\r\n+}\r\n+/*\r\n+    驱动写\r\n+*/\r\n+int hal_device_write(hal_device_t *dev, int pos, const void *buffer, int size)\r\n+{\r\n+    HAL_DEV_NULL_CHECK(dev);\r\n+    if(dev->dops->write)\r\n+        return dev->dops->write(dev, pos, buffer, size);\r\n+\r\n+    return HAL_ERROR;\r\n+}\r\n+/*\r\n+    驱动控制\r\n+*/\r\n+int hal_device_ctrl(hal_device_t *dev,  int cmd, void *arg)\r\n+{\r\n+    HAL_DEV_NULL_CHECK(dev);\r\n+    if(dev->dops->control)\r\n+        return dev->dops->control(dev, cmd, arg);\r\n+\r\n+    return HAL_ERROR;\r\n+}\r\n+/*\r\n+    驱动配置\r\n+*/\r\n+int hal_device_cfg(hal_device_t *dev, void *args, void *var)\r\n+{\r\n+    HAL_DEV_NULL_CHECK(dev);\r\n+\r\n+    if(dev->dops->config)\r\n+        return dev->dops->config(dev, args, var);\r\n+\r\n+    return HAL_ERROR;\r\n+}\r\n+\r\n+/*\r\n+    驱动初始化\r\n+*/\r\n+int hal_device_init(hal_device_t *dev)\r\n+{\r\n+    HAL_DEV_NULL_CHECK(dev);\r\n+\r\n+    if(dev->dops->init)\r\n+        return dev->dops->init(dev);\r\n+\r\n+    return HAL_ERROR;\r\n+}\r\n+/*\r\n+    设置驱动属于哪个任务\r\n+*/\r\n+void hal_device_set_owner(hal_device_t *dev, const void *owner)\r\n+{\r\n+    dev->owner = (void *)owner;\r\n+}\r\n+\r\n+\r\n"
                },
                {
                    "date": 1677081917358,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -28,9 +28,9 @@\n         LOG_ERROR(\"%s\\r\\n\", cur->name);\r\n         hdev_list->next = NULL;\r\n     }else\r\n     {\r\n-        while(NULL != cur->next)\r\n+        while(NULL != hdev_list->next)\r\n             cur = cur->next;\r\n         cur->next = dev;\r\n         dev->next = NULL;\r\n         LOG_ERROR(\"%s\\r\\n\", cur->name);\r\n@@ -137,144 +137,4 @@\n     dev->owner = (void *)owner;\r\n }\r\n \r\n \r\n-#include \"hal_device.h\"\r\n-#include <string.h>\r\n-\r\n-hal_device_t *hdev_list = NULL;\r\n-\r\n-// 查找设备是否存在\r\n-static int hal_device_is_exists(hal_device_t *dev)\r\n-{\r\n-    hal_device_t *cur = hdev_list;\r\n-    while (NULL != cur)\r\n-    {\r\n-        if(strcmp(cur->name, dev->name) == 0)\r\n-            return HAL_ERROR;\r\n-        cur = cur->next;\r\n-    }\r\n-    return HAL_OK;\r\n-}\r\n-\r\n-// 插入设备\r\n-static int hal_device_inster(hal_device_t *dev)\r\n-{\r\n-    hal_device_t *cur = hdev_list;\r\n-    if( NULL == dev )\r\n-        return HAL_ERROR;\r\n-    if(NULL == hdev_list)\r\n-    {\r\n-        cur = dev;\r\n-        LOG_ERROR(\"%s\\r\\n\", cur->name);\r\n-        cur->next = NULL;\r\n-    }else\r\n-    {\r\n-        while(NULL != cur->next)\r\n-            cur = cur->next;\r\n-        cur->next = dev;\r\n-        dev->next = NULL;\r\n-        LOG_ERROR(\"%s\\r\\n\", cur->name);\r\n-    }\r\n-    return HAL_OK;\r\n-}\r\n-\r\n-// 驱动注册\r\n-int hal_device_register(hal_device_t *dev)\r\n-{\r\n-    HAL_DEV_NULL_CHECK(dev);\r\n-\r\n-    LOG_DEBUG(\"register : %s\\r\\n\", dev->name);\r\n-\r\n-    // if((NULL==dev->name) || (NULL==dev->dops) || (hal_device_is_exists(dev)==HAL_ERROR))\r\n-    // {\r\n-    //     return HAL_ERROR;\r\n-    // }\r\n-    return hal_device_inster(dev);\r\n-}\r\n-\r\n-hal_device_t *hal_device_find(const char *name)\r\n-{\r\n-    LOG_DEBUG(\"find : %s\\r\\n\", name);\r\n-    hal_device_t *cur = hdev_list;\r\n-    while (NULL != cur)\r\n-    {\r\n-        LOG_DEBUG(\"|%s| |%s|\\r\\n\",cur->name, name);\r\n-        if(strcmp(cur->name, name) == 0)\r\n-        {\r\n-            LOG_DEBUG(\"===\\r\\n\");\r\n-            return cur;\r\n-        }\r\n-        cur = cur->next;\r\n-    }\r\n-    return NULL;\r\n-}\r\n-\r\n-\r\n-/*\r\n-    驱动读\r\n-*/\r\n-int hal_device_read(hal_device_t *dev,  int pos, void *buffer, int size)\r\n-{\r\n-    HAL_DEV_NULL_CHECK(dev);\r\n-\r\n-    if(dev->dops->read)\r\n-        return dev->dops->read(dev, pos, buffer, size);\r\n-\r\n-    return HAL_ERROR;\r\n-}\r\n-/*\r\n-    驱动写\r\n-*/\r\n-int hal_device_write(hal_device_t *dev, int pos, const void *buffer, int size)\r\n-{\r\n-    HAL_DEV_NULL_CHECK(dev);\r\n-    if(dev->dops->write)\r\n-        return dev->dops->write(dev, pos, buffer, size);\r\n-\r\n-    return HAL_ERROR;\r\n-}\r\n-/*\r\n-    驱动控制\r\n-*/\r\n-int hal_device_ctrl(hal_device_t *dev,  int cmd, void *arg)\r\n-{\r\n-    HAL_DEV_NULL_CHECK(dev);\r\n-    if(dev->dops->control)\r\n-        return dev->dops->control(dev, cmd, arg);\r\n-\r\n-    return HAL_ERROR;\r\n-}\r\n-/*\r\n-    驱动配置\r\n-*/\r\n-int hal_device_cfg(hal_device_t *dev, void *args, void *var)\r\n-{\r\n-    HAL_DEV_NULL_CHECK(dev);\r\n-\r\n-    if(dev->dops->config)\r\n-        return dev->dops->config(dev, args, var);\r\n-\r\n-    return HAL_ERROR;\r\n-}\r\n-\r\n-/*\r\n-    驱动初始化\r\n-*/\r\n-int hal_device_init(hal_device_t *dev)\r\n-{\r\n-    HAL_DEV_NULL_CHECK(dev);\r\n-\r\n-    if(dev->dops->init)\r\n-        return dev->dops->init(dev);\r\n-\r\n-    return HAL_ERROR;\r\n-}\r\n-/*\r\n-    设置驱动属于哪个任务\r\n-*/\r\n-void hal_device_set_owner(hal_device_t *dev, const void *owner)\r\n-{\r\n-    dev->owner = (void *)owner;\r\n-}\r\n-\r\n-\r\n"
                },
                {
                    "date": 1677081933269,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,140 @@\n+#include \"hal_device.h\"\r\n+#include <string.h>\r\n+\r\n+hal_device_t *hdev_list = NULL;\r\n+\r\n+// 查找设备是否存在\r\n+static int hal_device_is_exists(hal_device_t *dev)\r\n+{\r\n+    hal_device_t *cur = hdev_list;\r\n+    while (NULL != cur)\r\n+    {\r\n+        if(strcmp(cur->name, dev->name) == 0)\r\n+            return HAL_ERROR;\r\n+        cur = cur->next;\r\n+    }\r\n+    return HAL_OK;\r\n+}\r\n+\r\n+// 插入设备\r\n+static int hal_device_inster(hal_device_t *dev)\r\n+{\r\n+    hal_device_t *cur = hdev_list;\r\n+    if( NULL == dev )\r\n+        return HAL_ERROR;\r\n+    if(NULL == cur)\r\n+    {\r\n+        cur = dev;\r\n+        LOG_ERROR(\"%s\\r\\n\", cur->name);\r\n+        dev->next = NULL;\r\n+    }else\r\n+    {\r\n+        while(NULL != cur->next)\r\n+            cur = cur->next;\r\n+        cur->next = dev;\r\n+        dev->next = NULL;\r\n+        LOG_ERROR(\"%s\\r\\n\", cur->name);\r\n+    }\r\n+    return HAL_OK;\r\n+}\r\n+\r\n+// 驱动注册\r\n+int hal_device_register(hal_device_t *dev)\r\n+{\r\n+    HAL_DEV_NULL_CHECK(dev);\r\n+\r\n+    LOG_DEBUG(\"register : %s\\r\\n\", dev->name);\r\n+\r\n+    // if((NULL==dev->name) || (NULL==dev->dops) || (hal_device_is_exists(dev)==HAL_ERROR))\r\n+    // {\r\n+    //     return HAL_ERROR;\r\n+    // }\r\n+    return hal_device_inster(dev);\r\n+}\r\n+\r\n+hal_device_t *hal_device_find(const char *name)\r\n+{\r\n+    LOG_DEBUG(\"find : %s\\r\\n\", name);\r\n+    hal_device_t *cur = hdev_list;\r\n+    while (NULL != cur)\r\n+    {\r\n+        LOG_DEBUG(\"|%s| |%s|\\r\\n\",cur->name, name);\r\n+        if(strcmp(cur->name, name) == 0)\r\n+        {\r\n+            LOG_DEBUG(\"===\\r\\n\");\r\n+            return cur;\r\n+        }\r\n+        cur = cur->next;\r\n+    }\r\n+    return NULL;\r\n+}\r\n+\r\n+\r\n+/*\r\n+    驱动读\r\n+*/\r\n+int hal_device_read(hal_device_t *dev,  int pos, void *buffer, int size)\r\n+{\r\n+    HAL_DEV_NULL_CHECK(dev);\r\n+\r\n+    if(dev->dops->read)\r\n+        return dev->dops->read(dev, pos, buffer, size);\r\n+\r\n+    return HAL_ERROR;\r\n+}\r\n+/*\r\n+    驱动写\r\n+*/\r\n+int hal_device_write(hal_device_t *dev, int pos, const void *buffer, int size)\r\n+{\r\n+    HAL_DEV_NULL_CHECK(dev);\r\n+    if(dev->dops->write)\r\n+        return dev->dops->write(dev, pos, buffer, size);\r\n+\r\n+    return HAL_ERROR;\r\n+}\r\n+/*\r\n+    驱动控制\r\n+*/\r\n+int hal_device_ctrl(hal_device_t *dev,  int cmd, void *arg)\r\n+{\r\n+    HAL_DEV_NULL_CHECK(dev);\r\n+    if(dev->dops->control)\r\n+        return dev->dops->control(dev, cmd, arg);\r\n+\r\n+    return HAL_ERROR;\r\n+}\r\n+/*\r\n+    驱动配置\r\n+*/\r\n+int hal_device_cfg(hal_device_t *dev, void *args, void *var)\r\n+{\r\n+    HAL_DEV_NULL_CHECK(dev);\r\n+\r\n+    if(dev->dops->config)\r\n+        return dev->dops->config(dev, args, var);\r\n+\r\n+    return HAL_ERROR;\r\n+}\r\n+\r\n+/*\r\n+    驱动初始化\r\n+*/\r\n+int hal_device_init(hal_device_t *dev)\r\n+{\r\n+    HAL_DEV_NULL_CHECK(dev);\r\n+\r\n+    if(dev->dops->init)\r\n+        return dev->dops->init(dev);\r\n+\r\n+    return HAL_ERROR;\r\n+}\r\n+/*\r\n+    设置驱动属于哪个任务\r\n+*/\r\n+void hal_device_set_owner(hal_device_t *dev, const void *owner)\r\n+{\r\n+    dev->owner = (void *)owner;\r\n+}\r\n+\r\n+\r\n"
                },
                {
                    "date": 1677081941306,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -23,10 +23,10 @@\n     if( NULL == dev )\r\n         return HAL_ERROR;\r\n     if(NULL == cur)\r\n     {\r\n-        cur = dev;\r\n-        LOG_ERROR(\"%s\\r\\n\", cur->name);\r\n+        hdev_list = dev;\r\n+        LOG_ERROR(\"%s\\r\\n\", hdev_list->name);\r\n         dev->next = NULL;\r\n     }else\r\n     {\r\n         while(NULL != cur->next)\r\n@@ -137,144 +137,4 @@\n     dev->owner = (void *)owner;\r\n }\r\n \r\n \r\n-#include \"hal_device.h\"\r\n-#include <string.h>\r\n-\r\n-hal_device_t *hdev_list = NULL;\r\n-\r\n-// 查找设备是否存在\r\n-static int hal_device_is_exists(hal_device_t *dev)\r\n-{\r\n-    hal_device_t *cur = hdev_list;\r\n-    while (NULL != cur)\r\n-    {\r\n-        if(strcmp(cur->name, dev->name) == 0)\r\n-            return HAL_ERROR;\r\n-        cur = cur->next;\r\n-    }\r\n-    return HAL_OK;\r\n-}\r\n-\r\n-// 插入设备\r\n-static int hal_device_inster(hal_device_t *dev)\r\n-{\r\n-    hal_device_t *cur = hdev_list;\r\n-    if( NULL == dev )\r\n-        return HAL_ERROR;\r\n-    if(NULL == hdev_list)\r\n-    {\r\n-        hdev_list = dev;\r\n-        LOG_ERROR(\"%s\\r\\n\", cur->name);\r\n-        hdev_list->next = NULL;\r\n-    }else\r\n-    {\r\n-        while(NULL != hdev_list->next)\r\n-            cur = cur->next;\r\n-        cur->next = dev;\r\n-        dev->next = NULL;\r\n-        LOG_ERROR(\"%s\\r\\n\", cur->name);\r\n-    }\r\n-    return HAL_OK;\r\n-}\r\n-\r\n-// 驱动注册\r\n-int hal_device_register(hal_device_t *dev)\r\n-{\r\n-    HAL_DEV_NULL_CHECK(dev);\r\n-\r\n-    LOG_DEBUG(\"register : %s\\r\\n\", dev->name);\r\n-\r\n-    // if((NULL==dev->name) || (NULL==dev->dops) || (hal_device_is_exists(dev)==HAL_ERROR))\r\n-    // {\r\n-    //     return HAL_ERROR;\r\n-    // }\r\n-    return hal_device_inster(dev);\r\n-}\r\n-\r\n-hal_device_t *hal_device_find(const char *name)\r\n-{\r\n-    LOG_DEBUG(\"find : %s\\r\\n\", name);\r\n-    hal_device_t *cur = hdev_list;\r\n-    while (NULL != cur)\r\n-    {\r\n-        LOG_DEBUG(\"|%s| |%s|\\r\\n\",cur->name, name);\r\n-        if(strcmp(cur->name, name) == 0)\r\n-        {\r\n-            LOG_DEBUG(\"===\\r\\n\");\r\n-            return cur;\r\n-        }\r\n-        cur = cur->next;\r\n-    }\r\n-    return NULL;\r\n-}\r\n-\r\n-\r\n-/*\r\n-    驱动读\r\n-*/\r\n-int hal_device_read(hal_device_t *dev,  int pos, void *buffer, int size)\r\n-{\r\n-    HAL_DEV_NULL_CHECK(dev);\r\n-\r\n-    if(dev->dops->read)\r\n-        return dev->dops->read(dev, pos, buffer, size);\r\n-\r\n-    return HAL_ERROR;\r\n-}\r\n-/*\r\n-    驱动写\r\n-*/\r\n-int hal_device_write(hal_device_t *dev, int pos, const void *buffer, int size)\r\n-{\r\n-    HAL_DEV_NULL_CHECK(dev);\r\n-    if(dev->dops->write)\r\n-        return dev->dops->write(dev, pos, buffer, size);\r\n-\r\n-    return HAL_ERROR;\r\n-}\r\n-/*\r\n-    驱动控制\r\n-*/\r\n-int hal_device_ctrl(hal_device_t *dev,  int cmd, void *arg)\r\n-{\r\n-    HAL_DEV_NULL_CHECK(dev);\r\n-    if(dev->dops->control)\r\n-        return dev->dops->control(dev, cmd, arg);\r\n-\r\n-    return HAL_ERROR;\r\n-}\r\n-/*\r\n-    驱动配置\r\n-*/\r\n-int hal_device_cfg(hal_device_t *dev, void *args, void *var)\r\n-{\r\n-    HAL_DEV_NULL_CHECK(dev);\r\n-\r\n-    if(dev->dops->config)\r\n-        return dev->dops->config(dev, args, var);\r\n-\r\n-    return HAL_ERROR;\r\n-}\r\n-\r\n-/*\r\n-    驱动初始化\r\n-*/\r\n-int hal_device_init(hal_device_t *dev)\r\n-{\r\n-    HAL_DEV_NULL_CHECK(dev);\r\n-\r\n-    if(dev->dops->init)\r\n-        return dev->dops->init(dev);\r\n-\r\n-    return HAL_ERROR;\r\n-}\r\n-/*\r\n-    设置驱动属于哪个任务\r\n-*/\r\n-void hal_device_set_owner(hal_device_t *dev, const void *owner)\r\n-{\r\n-    dev->owner = (void *)owner;\r\n-}\r\n-\r\n-\r\n"
                },
                {
                    "date": 1677081948618,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -25,13 +25,13 @@\n     if(NULL == cur)\r\n     {\r\n         hdev_list = dev;\r\n         LOG_ERROR(\"%s\\r\\n\", hdev_list->name);\r\n-        dev->next = NULL;\r\n+        hdev_list->next = NULL;\r\n     }else\r\n     {\r\n-        while(NULL != cur->next)\r\n-            cur = cur->next;\r\n+        while(NULL != hdev_list->next)\r\n+            cur = hdev_list->next;\r\n         cur->next = dev;\r\n         dev->next = NULL;\r\n         LOG_ERROR(\"%s\\r\\n\", cur->name);\r\n     }\r\n"
                },
                {
                    "date": 1677081955963,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -29,13 +29,14 @@\n         hdev_list->next = NULL;\r\n     }else\r\n     {\r\n         while(NULL != hdev_list->next)\r\n-            cur = hdev_list->next;\r\n-        cur->next = dev;\r\n+            hdev_list = hdev_list->next;\r\n+        hdev_list->next = dev;\r\n         dev->next = NULL;\r\n         LOG_ERROR(\"%s\\r\\n\", cur->name);\r\n     }\r\n+    \r\n     return HAL_OK;\r\n }\r\n \r\n // 驱动注册\r\n"
                },
                {
                    "date": 1677081962130,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -34,9 +34,9 @@\n         hdev_list->next = dev;\r\n         dev->next = NULL;\r\n         LOG_ERROR(\"%s\\r\\n\", cur->name);\r\n     }\r\n-    \r\n+    hdev_list = cur;\r\n     return HAL_OK;\r\n }\r\n \r\n // 驱动注册\r\n"
                },
                {
                    "date": 1677081997598,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -24,19 +24,18 @@\n         return HAL_ERROR;\r\n     if(NULL == cur)\r\n     {\r\n         hdev_list = dev;\r\n-        LOG_ERROR(\"%s\\r\\n\", hdev_list->name);\r\n-        hdev_list->next = NULL;\r\n+        LOG_ERROR(\"%s\\r\\n\", cur->name);\r\n+        dev->next = NULL;\r\n     }else\r\n     {\r\n-        while(NULL != hdev_list->next)\r\n-            hdev_list = hdev_list->next;\r\n-        hdev_list->next = dev;\r\n+        while(NULL != cur->next)\r\n+            cur = cur->next;\r\n+        cur->next = dev;\r\n         dev->next = NULL;\r\n         LOG_ERROR(\"%s\\r\\n\", cur->name);\r\n     }\r\n-    hdev_list = cur;\r\n     return HAL_OK;\r\n }\r\n \r\n // 驱动注册\r\n@@ -54,8 +53,9 @@\n }\r\n \r\n hal_device_t *hal_device_find(const char *name)\r\n {\r\n+    HAL_DEV_NULL_CHECK(name);\r\n     LOG_DEBUG(\"find : %s\\r\\n\", name);\r\n     hal_device_t *cur = hdev_list;\r\n     while (NULL != cur)\r\n     {\r\n"
                },
                {
                    "date": 1677082004204,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -53,9 +53,8 @@\n }\r\n \r\n hal_device_t *hal_device_find(const char *name)\r\n {\r\n-    HAL_DEV_NULL_CHECK(name);\r\n     LOG_DEBUG(\"find : %s\\r\\n\", name);\r\n     hal_device_t *cur = hdev_list;\r\n     while (NULL != cur)\r\n     {\r\n"
                },
                {
                    "date": 1677082045959,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -28,9 +28,9 @@\n         LOG_ERROR(\"%s\\r\\n\", cur->name);\r\n         dev->next = NULL;\r\n     }else\r\n     {\r\n-        while(NULL != cur->next)\r\n+        while(NULL != hdev_list->next)\r\n             cur = cur->next;\r\n         cur->next = dev;\r\n         dev->next = NULL;\r\n         LOG_ERROR(\"%s\\r\\n\", cur->name);\r\n"
                },
                {
                    "date": 1677082052212,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -29,10 +29,10 @@\n         dev->next = NULL;\r\n     }else\r\n     {\r\n         while(NULL != hdev_list->next)\r\n-            cur = cur->next;\r\n-        cur->next = dev;\r\n+            hdev_list = hdev_list->next;\r\n+        hdev_list->next = dev;\r\n         dev->next = NULL;\r\n         LOG_ERROR(\"%s\\r\\n\", cur->name);\r\n     }\r\n     return HAL_OK;\r\n"
                },
                {
                    "date": 1677082058467,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,141 @@\n+#include \"hal_device.h\"\r\n+#include <string.h>\r\n+\r\n+hal_device_t *hdev_list = NULL;\r\n+\r\n+// 查找设备是否存在\r\n+static int hal_device_is_exists(hal_device_t *dev)\r\n+{\r\n+    hal_device_t *cur = hdev_list;\r\n+    while (NULL != cur)\r\n+    {\r\n+        if(strcmp(cur->name, dev->name) == 0)\r\n+            return HAL_ERROR;\r\n+        cur = cur->next;\r\n+    }\r\n+    return HAL_OK;\r\n+}\r\n+\r\n+// 插入设备\r\n+static int hal_device_inster(hal_device_t *dev)\r\n+{\r\n+    hal_device_t *cur = hdev_list;\r\n+    if( NULL == dev )\r\n+        return HAL_ERROR;\r\n+    if(NULL == cur)\r\n+    {\r\n+        hdev_list = dev;\r\n+        LOG_ERROR(\"%s\\r\\n\", hdev_list->name);\r\n+        dev->next = NULL;\r\n+    }else\r\n+    {\r\n+        while(NULL != hdev_list->next)\r\n+            hdev_list = hdev_list->next;\r\n+        hdev_list->next = dev;\r\n+        dev->next = NULL;\r\n+        LOG_ERROR(\"%s\\r\\n\", hdev_list->name);\r\n+    }\r\n+    hdev_list = cur;\r\n+    return HAL_OK;\r\n+}\r\n+\r\n+// 驱动注册\r\n+int hal_device_register(hal_device_t *dev)\r\n+{\r\n+    HAL_DEV_NULL_CHECK(dev);\r\n+\r\n+    LOG_DEBUG(\"register : %s\\r\\n\", dev->name);\r\n+\r\n+    // if((NULL==dev->name) || (NULL==dev->dops) || (hal_device_is_exists(dev)==HAL_ERROR))\r\n+    // {\r\n+    //     return HAL_ERROR;\r\n+    // }\r\n+    return hal_device_inster(dev);\r\n+}\r\n+\r\n+hal_device_t *hal_device_find(const char *name)\r\n+{\r\n+    LOG_DEBUG(\"find : %s\\r\\n\", name);\r\n+    hal_device_t *cur = hdev_list;\r\n+    while (NULL != cur)\r\n+    {\r\n+        LOG_DEBUG(\"|%s| |%s|\\r\\n\",cur->name, name);\r\n+        if(strcmp(cur->name, name) == 0)\r\n+        {\r\n+            LOG_DEBUG(\"===\\r\\n\");\r\n+            return cur;\r\n+        }\r\n+        cur = cur->next;\r\n+    }\r\n+    return NULL;\r\n+}\r\n+\r\n+\r\n+/*\r\n+    驱动读\r\n+*/\r\n+int hal_device_read(hal_device_t *dev,  int pos, void *buffer, int size)\r\n+{\r\n+    HAL_DEV_NULL_CHECK(dev);\r\n+\r\n+    if(dev->dops->read)\r\n+        return dev->dops->read(dev, pos, buffer, size);\r\n+\r\n+    return HAL_ERROR;\r\n+}\r\n+/*\r\n+    驱动写\r\n+*/\r\n+int hal_device_write(hal_device_t *dev, int pos, const void *buffer, int size)\r\n+{\r\n+    HAL_DEV_NULL_CHECK(dev);\r\n+    if(dev->dops->write)\r\n+        return dev->dops->write(dev, pos, buffer, size);\r\n+\r\n+    return HAL_ERROR;\r\n+}\r\n+/*\r\n+    驱动控制\r\n+*/\r\n+int hal_device_ctrl(hal_device_t *dev,  int cmd, void *arg)\r\n+{\r\n+    HAL_DEV_NULL_CHECK(dev);\r\n+    if(dev->dops->control)\r\n+        return dev->dops->control(dev, cmd, arg);\r\n+\r\n+    return HAL_ERROR;\r\n+}\r\n+/*\r\n+    驱动配置\r\n+*/\r\n+int hal_device_cfg(hal_device_t *dev, void *args, void *var)\r\n+{\r\n+    HAL_DEV_NULL_CHECK(dev);\r\n+\r\n+    if(dev->dops->config)\r\n+        return dev->dops->config(dev, args, var);\r\n+\r\n+    return HAL_ERROR;\r\n+}\r\n+\r\n+/*\r\n+    驱动初始化\r\n+*/\r\n+int hal_device_init(hal_device_t *dev)\r\n+{\r\n+    HAL_DEV_NULL_CHECK(dev);\r\n+\r\n+    if(dev->dops->init)\r\n+        return dev->dops->init(dev);\r\n+\r\n+    return HAL_ERROR;\r\n+}\r\n+/*\r\n+    设置驱动属于哪个任务\r\n+*/\r\n+void hal_device_set_owner(hal_device_t *dev, const void *owner)\r\n+{\r\n+    dev->owner = (void *)owner;\r\n+}\r\n+\r\n+\r\n"
                },
                {
                    "date": 1677082068777,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -8,9 +8,9 @@\n {\r\n     hal_device_t *cur = hdev_list;\r\n     while (NULL != cur)\r\n     {\r\n-        if(strcmp(cur->name, dev->name) == 0)\r\n+        if(strcmp(hdev_list->name, dev->name) == 0)\r\n             return HAL_ERROR;\r\n         cur = cur->next;\r\n     }\r\n     return HAL_OK;\r\n@@ -138,144 +138,4 @@\n     dev->owner = (void *)owner;\r\n }\r\n \r\n \r\n-#include \"hal_device.h\"\r\n-#include <string.h>\r\n-\r\n-hal_device_t *hdev_list = NULL;\r\n-\r\n-// 查找设备是否存在\r\n-static int hal_device_is_exists(hal_device_t *dev)\r\n-{\r\n-    hal_device_t *cur = hdev_list;\r\n-    while (NULL != cur)\r\n-    {\r\n-        if(strcmp(cur->name, dev->name) == 0)\r\n-            return HAL_ERROR;\r\n-        cur = cur->next;\r\n-    }\r\n-    return HAL_OK;\r\n-}\r\n-\r\n-// 插入设备\r\n-static int hal_device_inster(hal_device_t *dev)\r\n-{\r\n-    hal_device_t *cur = hdev_list;\r\n-    if( NULL == dev )\r\n-        return HAL_ERROR;\r\n-    if(NULL == cur)\r\n-    {\r\n-        hdev_list = dev;\r\n-        LOG_ERROR(\"%s\\r\\n\", cur->name);\r\n-        dev->next = NULL;\r\n-    }else\r\n-    {\r\n-        while(NULL != hdev_list->next)\r\n-            hdev_list = hdev_list->next;\r\n-        hdev_list->next = dev;\r\n-        dev->next = NULL;\r\n-        LOG_ERROR(\"%s\\r\\n\", cur->name);\r\n-    }\r\n-    return HAL_OK;\r\n-}\r\n-\r\n-// 驱动注册\r\n-int hal_device_register(hal_device_t *dev)\r\n-{\r\n-    HAL_DEV_NULL_CHECK(dev);\r\n-\r\n-    LOG_DEBUG(\"register : %s\\r\\n\", dev->name);\r\n-\r\n-    // if((NULL==dev->name) || (NULL==dev->dops) || (hal_device_is_exists(dev)==HAL_ERROR))\r\n-    // {\r\n-    //     return HAL_ERROR;\r\n-    // }\r\n-    return hal_device_inster(dev);\r\n-}\r\n-\r\n-hal_device_t *hal_device_find(const char *name)\r\n-{\r\n-    LOG_DEBUG(\"find : %s\\r\\n\", name);\r\n-    hal_device_t *cur = hdev_list;\r\n-    while (NULL != cur)\r\n-    {\r\n-        LOG_DEBUG(\"|%s| |%s|\\r\\n\",cur->name, name);\r\n-        if(strcmp(cur->name, name) == 0)\r\n-        {\r\n-            LOG_DEBUG(\"===\\r\\n\");\r\n-            return cur;\r\n-        }\r\n-        cur = cur->next;\r\n-    }\r\n-    return NULL;\r\n-}\r\n-\r\n-\r\n-/*\r\n-    驱动读\r\n-*/\r\n-int hal_device_read(hal_device_t *dev,  int pos, void *buffer, int size)\r\n-{\r\n-    HAL_DEV_NULL_CHECK(dev);\r\n-\r\n-    if(dev->dops->read)\r\n-        return dev->dops->read(dev, pos, buffer, size);\r\n-\r\n-    return HAL_ERROR;\r\n-}\r\n-/*\r\n-    驱动写\r\n-*/\r\n-int hal_device_write(hal_device_t *dev, int pos, const void *buffer, int size)\r\n-{\r\n-    HAL_DEV_NULL_CHECK(dev);\r\n-    if(dev->dops->write)\r\n-        return dev->dops->write(dev, pos, buffer, size);\r\n-\r\n-    return HAL_ERROR;\r\n-}\r\n-/*\r\n-    驱动控制\r\n-*/\r\n-int hal_device_ctrl(hal_device_t *dev,  int cmd, void *arg)\r\n-{\r\n-    HAL_DEV_NULL_CHECK(dev);\r\n-    if(dev->dops->control)\r\n-        return dev->dops->control(dev, cmd, arg);\r\n-\r\n-    return HAL_ERROR;\r\n-}\r\n-/*\r\n-    驱动配置\r\n-*/\r\n-int hal_device_cfg(hal_device_t *dev, void *args, void *var)\r\n-{\r\n-    HAL_DEV_NULL_CHECK(dev);\r\n-\r\n-    if(dev->dops->config)\r\n-        return dev->dops->config(dev, args, var);\r\n-\r\n-    return HAL_ERROR;\r\n-}\r\n-\r\n-/*\r\n-    驱动初始化\r\n-*/\r\n-int hal_device_init(hal_device_t *dev)\r\n-{\r\n-    HAL_DEV_NULL_CHECK(dev);\r\n-\r\n-    if(dev->dops->init)\r\n-        return dev->dops->init(dev);\r\n-\r\n-    return HAL_ERROR;\r\n-}\r\n-/*\r\n-    设置驱动属于哪个任务\r\n-*/\r\n-void hal_device_set_owner(hal_device_t *dev, const void *owner)\r\n-{\r\n-    dev->owner = (void *)owner;\r\n-}\r\n-\r\n-\r\n"
                },
                {
                    "date": 1677082074940,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -10,10 +10,11 @@\n     while (NULL != cur)\r\n     {\r\n         if(strcmp(hdev_list->name, dev->name) == 0)\r\n             return HAL_ERROR;\r\n-        cur = cur->next;\r\n+        hdev_list = hdev_list->next;\r\n     }\r\n+    hdev_list = \r\n     return HAL_OK;\r\n }\r\n \r\n // 插入设备\r\n"
                },
                {
                    "date": 1677082111266,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,142 @@\n+#include \"hal_device.h\"\r\n+#include <string.h>\r\n+\r\n+hal_device_t *hdev_list = NULL;\r\n+\r\n+// 查找设备是否存在\r\n+static int hal_device_is_exists(hal_device_t *dev)\r\n+{\r\n+    HAL_DEV_NULL_CHECK(dev);\r\n+    hal_device_t *cur = hdev_list;\r\n+    while (NULL != cur)\r\n+    {\r\n+        if(strcmp(cur->name, dev->name) == 0)\r\n+            return HAL_ERROR;\r\n+        cur = cur->next;\r\n+    }\r\n+    return HAL_OK;\r\n+}\r\n+\r\n+// 插入设备\r\n+static int hal_device_inster(hal_device_t *dev)\r\n+{\r\n+    hal_device_t *cur = hdev_list;\r\n+    if( NULL == dev )\r\n+        return HAL_ERROR;\r\n+    if(NULL == cur)\r\n+    {\r\n+        cur = dev;\r\n+        LOG_ERROR(\"%s\\r\\n\", cur->name);\r\n+        cur->next = NULL;\r\n+    }else\r\n+    {\r\n+        LOG_ERROR(\"%s\\r\\n\", cur->name);\r\n+        while(NULL != cur)\r\n+            cur = cur->next;\r\n+        cur->next = dev;\r\n+        dev->next = NULL;\r\n+    }\r\n+    return HAL_OK;\r\n+}\r\n+\r\n+// 驱动注册\r\n+int hal_device_register(hal_device_t *dev)\r\n+{\r\n+    HAL_DEV_NULL_CHECK(dev);\r\n+\r\n+    LOG_DEBUG(\"register : %s\\r\\n\", dev->name);\r\n+\r\n+    // if((NULL==dev->name) || (NULL==dev->dops) || (hal_device_is_exists(dev)==HAL_ERROR))\r\n+    // {\r\n+    //     return HAL_ERROR;\r\n+    // }\r\n+    return hal_device_inster(dev);\r\n+}\r\n+\r\n+hal_device_t *hal_device_find(const char *name)\r\n+{\r\n+    HAL_DEV_NULL_CHECK(name);\r\n+    LOG_DEBUG(\"find : %s\\r\\n\", name);\r\n+    hal_device_t *cur = hdev_list;\r\n+    while (NULL != cur)\r\n+    {\r\n+        LOG_DEBUG(\"|%s| |%s|\\r\\n\",cur->name, name);\r\n+        if(strcmp(cur->name, name) == 0)\r\n+        {\r\n+            LOG_DEBUG(\"===\\r\\n\");\r\n+            return cur;\r\n+        }\r\n+        cur = cur->next;\r\n+    }\r\n+    return NULL;\r\n+}\r\n+\r\n+\r\n+/*\r\n+    驱动读\r\n+*/\r\n+int hal_device_read(hal_device_t *dev,  int pos, void *buffer, int size)\r\n+{\r\n+    HAL_DEV_NULL_CHECK(dev);\r\n+\r\n+    if(dev->dops->read)\r\n+        return dev->dops->read(dev, pos, buffer, size);\r\n+\r\n+    return HAL_ERROR;\r\n+}\r\n+/*\r\n+    驱动写\r\n+*/\r\n+int hal_device_write(hal_device_t *dev, int pos, const void *buffer, int size)\r\n+{\r\n+    HAL_DEV_NULL_CHECK(dev);\r\n+    if(dev->dops->write)\r\n+        return dev->dops->write(dev, pos, buffer, size);\r\n+\r\n+    return HAL_ERROR;\r\n+}\r\n+/*\r\n+    驱动控制\r\n+*/\r\n+int hal_device_ctrl(hal_device_t *dev,  int cmd, void *arg)\r\n+{\r\n+    HAL_DEV_NULL_CHECK(dev);\r\n+    if(dev->dops->control)\r\n+        return dev->dops->control(dev, cmd, arg);\r\n+\r\n+    return HAL_ERROR;\r\n+}\r\n+/*\r\n+    驱动配置\r\n+*/\r\n+int hal_device_cfg(hal_device_t *dev, void *args, void *var)\r\n+{\r\n+    HAL_DEV_NULL_CHECK(dev);\r\n+\r\n+    if(dev->dops->config)\r\n+        return dev->dops->config(dev, args, var);\r\n+\r\n+    return HAL_ERROR;\r\n+}\r\n+\r\n+/*\r\n+    驱动初始化\r\n+*/\r\n+int hal_device_init(hal_device_t *dev)\r\n+{\r\n+    HAL_DEV_NULL_CHECK(dev);\r\n+\r\n+    if(dev->dops->init)\r\n+        return dev->dops->init(dev);\r\n+\r\n+    return HAL_ERROR;\r\n+}\r\n+/*\r\n+    设置驱动属于哪个任务\r\n+*/\r\n+void hal_device_set_owner(hal_device_t *dev, const void *owner)\r\n+{\r\n+    dev->owner = (void *)owner;\r\n+}\r\n+\r\n+\r\n"
                },
                {
                    "date": 1677082116809,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -5,9 +5,8 @@\n \r\n // 查找设备是否存在\r\n static int hal_device_is_exists(hal_device_t *dev)\r\n {\r\n-    HAL_DEV_NULL_CHECK(dev);\r\n     hal_device_t *cur = hdev_list;\r\n     while (NULL != cur)\r\n     {\r\n         if(strcmp(cur->name, dev->name) == 0)\r\n@@ -29,13 +28,13 @@\n         LOG_ERROR(\"%s\\r\\n\", cur->name);\r\n         cur->next = NULL;\r\n     }else\r\n     {\r\n-        LOG_ERROR(\"%s\\r\\n\", cur->name);\r\n-        while(NULL != cur)\r\n+        while(NULL != cur->next)\r\n             cur = cur->next;\r\n         cur->next = dev;\r\n         dev->next = NULL;\r\n+        LOG_ERROR(\"%s\\r\\n\", cur->name);\r\n     }\r\n     return HAL_OK;\r\n }\r\n \r\n@@ -139,146 +138,4 @@\n     dev->owner = (void *)owner;\r\n }\r\n \r\n \r\n-#include \"hal_device.h\"\r\n-#include <string.h>\r\n-\r\n-hal_device_t *hdev_list = NULL;\r\n-\r\n-// 查找设备是否存在\r\n-static int hal_device_is_exists(hal_device_t *dev)\r\n-{\r\n-    hal_device_t *cur = hdev_list;\r\n-    while (NULL != cur)\r\n-    {\r\n-        if(strcmp(hdev_list->name, dev->name) == 0)\r\n-            return HAL_ERROR;\r\n-        hdev_list = hdev_list->next;\r\n-    }\r\n-    hdev_list = \r\n-    return HAL_OK;\r\n-}\r\n-\r\n-// 插入设备\r\n-static int hal_device_inster(hal_device_t *dev)\r\n-{\r\n-    hal_device_t *cur = hdev_list;\r\n-    if( NULL == dev )\r\n-        return HAL_ERROR;\r\n-    if(NULL == cur)\r\n-    {\r\n-        hdev_list = dev;\r\n-        LOG_ERROR(\"%s\\r\\n\", hdev_list->name);\r\n-        dev->next = NULL;\r\n-    }else\r\n-    {\r\n-        while(NULL != hdev_list->next)\r\n-            hdev_list = hdev_list->next;\r\n-        hdev_list->next = dev;\r\n-        dev->next = NULL;\r\n-        LOG_ERROR(\"%s\\r\\n\", hdev_list->name);\r\n-    }\r\n-    hdev_list = cur;\r\n-    return HAL_OK;\r\n-}\r\n-\r\n-// 驱动注册\r\n-int hal_device_register(hal_device_t *dev)\r\n-{\r\n-    HAL_DEV_NULL_CHECK(dev);\r\n-\r\n-    LOG_DEBUG(\"register : %s\\r\\n\", dev->name);\r\n-\r\n-    // if((NULL==dev->name) || (NULL==dev->dops) || (hal_device_is_exists(dev)==HAL_ERROR))\r\n-    // {\r\n-    //     return HAL_ERROR;\r\n-    // }\r\n-    return hal_device_inster(dev);\r\n-}\r\n-\r\n-hal_device_t *hal_device_find(const char *name)\r\n-{\r\n-    LOG_DEBUG(\"find : %s\\r\\n\", name);\r\n-    hal_device_t *cur = hdev_list;\r\n-    while (NULL != cur)\r\n-    {\r\n-        LOG_DEBUG(\"|%s| |%s|\\r\\n\",cur->name, name);\r\n-        if(strcmp(cur->name, name) == 0)\r\n-        {\r\n-            LOG_DEBUG(\"===\\r\\n\");\r\n-            return cur;\r\n-        }\r\n-        cur = cur->next;\r\n-    }\r\n-    return NULL;\r\n-}\r\n-\r\n-\r\n-/*\r\n-    驱动读\r\n-*/\r\n-int hal_device_read(hal_device_t *dev,  int pos, void *buffer, int size)\r\n-{\r\n-    HAL_DEV_NULL_CHECK(dev);\r\n-\r\n-    if(dev->dops->read)\r\n-        return dev->dops->read(dev, pos, buffer, size);\r\n-\r\n-    return HAL_ERROR;\r\n-}\r\n-/*\r\n-    驱动写\r\n-*/\r\n-int hal_device_write(hal_device_t *dev, int pos, const void *buffer, int size)\r\n-{\r\n-    HAL_DEV_NULL_CHECK(dev);\r\n-    if(dev->dops->write)\r\n-        return dev->dops->write(dev, pos, buffer, size);\r\n-\r\n-    return HAL_ERROR;\r\n-}\r\n-/*\r\n-    驱动控制\r\n-*/\r\n-int hal_device_ctrl(hal_device_t *dev,  int cmd, void *arg)\r\n-{\r\n-    HAL_DEV_NULL_CHECK(dev);\r\n-    if(dev->dops->control)\r\n-        return dev->dops->control(dev, cmd, arg);\r\n-\r\n-    return HAL_ERROR;\r\n-}\r\n-/*\r\n-    驱动配置\r\n-*/\r\n-int hal_device_cfg(hal_device_t *dev, void *args, void *var)\r\n-{\r\n-    HAL_DEV_NULL_CHECK(dev);\r\n-\r\n-    if(dev->dops->config)\r\n-        return dev->dops->config(dev, args, var);\r\n-\r\n-    return HAL_ERROR;\r\n-}\r\n-\r\n-/*\r\n-    驱动初始化\r\n-*/\r\n-int hal_device_init(hal_device_t *dev)\r\n-{\r\n-    HAL_DEV_NULL_CHECK(dev);\r\n-\r\n-    if(dev->dops->init)\r\n-        return dev->dops->init(dev);\r\n-\r\n-    return HAL_ERROR;\r\n-}\r\n-/*\r\n-    设置驱动属于哪个任务\r\n-*/\r\n-void hal_device_set_owner(hal_device_t *dev, const void *owner)\r\n-{\r\n-    dev->owner = (void *)owner;\r\n-}\r\n-\r\n-\r\n"
                },
                {
                    "date": 1677082137068,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -19,10 +19,8 @@\n // 插入设备\r\n static int hal_device_inster(hal_device_t *dev)\r\n {\r\n     hal_device_t *cur = hdev_list;\r\n-    if( NULL == dev )\r\n-        return HAL_ERROR;\r\n     if(NULL == cur)\r\n     {\r\n         cur = dev;\r\n         LOG_ERROR(\"%s\\r\\n\", cur->name);\r\n"
                },
                {
                    "date": 1677082147509,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -21,11 +21,11 @@\n {\r\n     hal_device_t *cur = hdev_list;\r\n     if(NULL == cur)\r\n     {\r\n-        cur = dev;\r\n+        hdev_list = dev;\r\n         LOG_ERROR(\"%s\\r\\n\", cur->name);\r\n-        cur->next = NULL;\r\n+        dev->next = NULL;\r\n     }else\r\n     {\r\n         while(NULL != cur->next)\r\n             cur = cur->next;\r\n"
                },
                {
                    "date": 1677082210270,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -5,8 +5,9 @@\n \r\n // 查找设备是否存在\r\n static int hal_device_is_exists(hal_device_t *dev)\r\n {\r\n+    HAL_DEV_NULL_CHECK(dev);\r\n     hal_device_t *cur = hdev_list;\r\n     while (NULL != cur)\r\n     {\r\n         if(strcmp(cur->name, dev->name) == 0)\r\n@@ -19,20 +20,22 @@\n // 插入设备\r\n static int hal_device_inster(hal_device_t *dev)\r\n {\r\n     hal_device_t *cur = hdev_list;\r\n+    if( NULL == dev )\r\n+        return HAL_ERROR;\r\n     if(NULL == cur)\r\n     {\r\n-        hdev_list = dev;\r\n+        cur = dev;\r\n         LOG_ERROR(\"%s\\r\\n\", cur->name);\r\n-        dev->next = NULL;\r\n+        cur->next = NULL;\r\n     }else\r\n     {\r\n-        while(NULL != cur->next)\r\n+        while(NULL != cur)\r\n             cur = cur->next;\r\n+        LOG_ERROR(\"%s\\r\\n\", cur->name);\r\n         cur->next = dev;\r\n         dev->next = NULL;\r\n-        LOG_ERROR(\"%s\\r\\n\", cur->name);\r\n     }\r\n     return HAL_OK;\r\n }\r\n \r\n"
                },
                {
                    "date": 1677082330019,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -22,8 +22,10 @@\n {\r\n     hal_device_t *cur = hdev_list;\r\n     if( NULL == dev )\r\n         return HAL_ERROR;\r\n+\r\n+    \r\n     if(NULL == cur)\r\n     {\r\n         cur = dev;\r\n         LOG_ERROR(\"%s\\r\\n\", cur->name);\r\n@@ -31,11 +33,11 @@\n     }else\r\n     {\r\n         while(NULL != cur)\r\n             cur = cur->next;\r\n-        LOG_ERROR(\"%s\\r\\n\", cur->name);\r\n         cur->next = dev;\r\n         dev->next = NULL;\r\n+        LOG_ERROR(\"%s\\r\\n\", cur->name);\r\n     }\r\n     return HAL_OK;\r\n }\r\n \r\n"
                },
                {
                    "date": 1677082335599,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -23,9 +23,9 @@\n     hal_device_t *cur = hdev_list;\r\n     if( NULL == dev )\r\n         return HAL_ERROR;\r\n \r\n-    \r\n+    if( hdev_list )\r\n     if(NULL == cur)\r\n     {\r\n         cur = dev;\r\n         LOG_ERROR(\"%s\\r\\n\", cur->name);\r\n"
                },
                {
                    "date": 1677082347758,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -23,9 +23,10 @@\n     hal_device_t *cur = hdev_list;\r\n     if( NULL == dev )\r\n         return HAL_ERROR;\r\n \r\n-    if( hdev_list )\r\n+    if( hdev_list == NULL)\r\n+    \r\n     if(NULL == cur)\r\n     {\r\n         cur = dev;\r\n         LOG_ERROR(\"%s\\r\\n\", cur->name);\r\n"
                },
                {
                    "date": 1677082355323,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -24,9 +24,10 @@\n     if( NULL == dev )\r\n         return HAL_ERROR;\r\n \r\n     if( hdev_list == NULL)\r\n-    \r\n+        LOG_ERROR(\"hdev_list == NULL\\r\\n\", cur->name);\r\n+\r\n     if(NULL == cur)\r\n     {\r\n         cur = dev;\r\n         LOG_ERROR(\"%s\\r\\n\", cur->name);\r\n"
                },
                {
                    "date": 1677082394705,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -24,13 +24,13 @@\n     if( NULL == dev )\r\n         return HAL_ERROR;\r\n \r\n     if( hdev_list == NULL)\r\n-        LOG_ERROR(\"hdev_list == NULL\\r\\n\", cur->name);\r\n+        LOG_ERROR(\"hdev_list == NULL\\r\\n\");\r\n \r\n     if(NULL == cur)\r\n     {\r\n-        cur = dev;\r\n+        hdev_list = dev;\r\n         LOG_ERROR(\"%s\\r\\n\", cur->name);\r\n         cur->next = NULL;\r\n     }else\r\n     {\r\n"
                },
                {
                    "date": 1677083109914,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,8 +1,8 @@\n #include \"hal_device.h\"\r\n #include <string.h>\r\n \r\n-hal_device_t *hdev_list = NULL;\r\n+static hal_device_t *hdev_list = NULL;\r\n \r\n // 查找设备是否存在\r\n static int hal_device_is_exists(hal_device_t *dev)\r\n {\r\n@@ -29,10 +29,10 @@\n \r\n     if(NULL == cur)\r\n     {\r\n         hdev_list = dev;\r\n-        LOG_ERROR(\"%s\\r\\n\", cur->name);\r\n-        cur->next = NULL;\r\n+        LOG_ERROR(\"%s\\r\\n\", hdev_list->name);\r\n+        hdev_list->next = NULL;\r\n     }else\r\n     {\r\n         while(NULL != cur)\r\n             cur = cur->next;\r\n"
                },
                {
                    "date": 1677083162064,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -23,9 +23,9 @@\n     hal_device_t *cur = hdev_list;\r\n     if( NULL == dev )\r\n         return HAL_ERROR;\r\n \r\n-    if( hdev_list == NULL)\r\n+    if( cur == NULL)\r\n         LOG_ERROR(\"hdev_list == NULL\\r\\n\");\r\n \r\n     if(NULL == cur)\r\n     {\r\n"
                },
                {
                    "date": 1677083187678,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -24,13 +24,13 @@\n     if( NULL == dev )\r\n         return HAL_ERROR;\r\n \r\n     if( cur == NULL)\r\n-        LOG_ERROR(\"hdev_list == NULL\\r\\n\");\r\n+        LOG_ERROR(\"cur == NULL\\r\\n\");\r\n \r\n     if(NULL == cur)\r\n     {\r\n-        hdev_list = dev;\r\n+        cur = dev;\r\n         LOG_ERROR(\"%s\\r\\n\", hdev_list->name);\r\n         hdev_list->next = NULL;\r\n     }else\r\n     {\r\n"
                },
                {
                    "date": 1677083345633,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -23,16 +23,16 @@\n     hal_device_t *cur = hdev_list;\r\n     if( NULL == dev )\r\n         return HAL_ERROR;\r\n \r\n-    if( cur == NULL)\r\n-        LOG_ERROR(\"cur == NULL\\r\\n\");\r\n+    \r\n \r\n+\r\n     if(NULL == cur)\r\n     {\r\n         cur = dev;\r\n-        LOG_ERROR(\"%s\\r\\n\", hdev_list->name);\r\n-        hdev_list->next = NULL;\r\n+        LOG_ERROR(\"%s\\r\\n\", cur->name);\r\n+        cur->next = NULL;\r\n     }else\r\n     {\r\n         while(NULL != cur)\r\n             cur = cur->next;\r\n"
                },
                {
                    "date": 1677083438013,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -23,8 +23,10 @@\n     hal_device_t *cur = hdev_list;\r\n     if( NULL == dev )\r\n         return HAL_ERROR;\r\n \r\n+        \r\n+\r\n     \r\n \r\n \r\n     if(NULL == cur)\r\n"
                },
                {
                    "date": 1677083446079,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -23,9 +23,9 @@\n     hal_device_t *cur = hdev_list;\r\n     if( NULL == dev )\r\n         return HAL_ERROR;\r\n \r\n-        \r\n+    while(cur)\r\n \r\n     \r\n \r\n \r\n"
                },
                {
                    "date": 1677083453139,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -23,10 +23,10 @@\n     hal_device_t *cur = hdev_list;\r\n     if( NULL == dev )\r\n         return HAL_ERROR;\r\n \r\n-    while(cur)\r\n \r\n+\r\n     \r\n \r\n \r\n     if(NULL == cur)\r\n"
                },
                {
                    "date": 1677083484883,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -24,8 +24,12 @@\n     if( NULL == dev )\r\n         return HAL_ERROR;\r\n \r\n \r\n+    if( cur == NULL )\r\n+    {\r\n+        \r\n+    }\r\n \r\n     \r\n \r\n \r\n"
                },
                {
                    "date": 1677083491707,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -26,8 +26,9 @@\n \r\n \r\n     if( cur == NULL )\r\n     {\r\n+        cur = dev;\r\n         \r\n     }\r\n \r\n     \r\n"
                },
                {
                    "date": 1677083499880,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -27,9 +27,9 @@\n \r\n     if( cur == NULL )\r\n     {\r\n         cur = dev;\r\n-        \r\n+        cur->next = NULL;\r\n     }\r\n \r\n     \r\n \r\n"
                },
                {
                    "date": 1677083505732,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -28,8 +28,15 @@\n     if( cur == NULL )\r\n     {\r\n         cur = dev;\r\n         cur->next = NULL;\r\n+    }else\r\n+    {\r\n+        while (cur.)\r\n+        {\r\n+            /* code */\r\n+        }\r\n+        \r\n     }\r\n \r\n     \r\n \r\n"
                },
                {
                    "date": 1677083515237,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -30,11 +30,11 @@\n         cur = dev;\r\n         cur->next = NULL;\r\n     }else\r\n     {\r\n-        while (cur.)\r\n+        while (cur->next != NULL)\r\n         {\r\n-            /* code */\r\n+            cur = cur.\r\n         }\r\n         \r\n     }\r\n \r\n"
                },
                {
                    "date": 1677083525236,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,161 @@\n+#include \"hal_device.h\"\r\n+#include <string.h>\r\n+\r\n+static hal_device_t *hdev_list = NULL;\r\n+\r\n+// 查找设备是否存在\r\n+static int hal_device_is_exists(hal_device_t *dev)\r\n+{\r\n+    HAL_DEV_NULL_CHECK(dev);\r\n+    hal_device_t *cur = hdev_list;\r\n+    while (NULL != cur)\r\n+    {\r\n+        if(strcmp(cur->name, dev->name) == 0)\r\n+            return HAL_ERROR;\r\n+        cur = cur->next;\r\n+    }\r\n+    return HAL_OK;\r\n+}\r\n+\r\n+// 插入设备\r\n+static int hal_device_inster(hal_device_t *dev)\r\n+{\r\n+    hal_device_t *cur = hdev_list;\r\n+    if( NULL == dev )\r\n+        return HAL_ERROR;\r\n+\r\n+\r\n+    if( cur == NULL )\r\n+    {\r\n+        cur = dev;\r\n+        cur->next = NULL;\r\n+    }else\r\n+    {\r\n+        while (cur->next != NULL)\r\n+        {\r\n+            cur = cur->next;\r\n+        }\r\n+        cur\r\n+        \r\n+    }\r\n+\r\n+    \r\n+\r\n+\r\n+    if(NULL == cur)\r\n+    {\r\n+        cur = dev;\r\n+        LOG_ERROR(\"%s\\r\\n\", cur->name);\r\n+        cur->next = NULL;\r\n+    }else\r\n+    {\r\n+        while(NULL != cur)\r\n+            cur = cur->next;\r\n+        cur->next = dev;\r\n+        dev->next = NULL;\r\n+        LOG_ERROR(\"%s\\r\\n\", cur->name);\r\n+    }\r\n+    return HAL_OK;\r\n+}\r\n+\r\n+// 驱动注册\r\n+int hal_device_register(hal_device_t *dev)\r\n+{\r\n+    HAL_DEV_NULL_CHECK(dev);\r\n+\r\n+    LOG_DEBUG(\"register : %s\\r\\n\", dev->name);\r\n+\r\n+    // if((NULL==dev->name) || (NULL==dev->dops) || (hal_device_is_exists(dev)==HAL_ERROR))\r\n+    // {\r\n+    //     return HAL_ERROR;\r\n+    // }\r\n+    return hal_device_inster(dev);\r\n+}\r\n+\r\n+hal_device_t *hal_device_find(const char *name)\r\n+{\r\n+    HAL_DEV_NULL_CHECK(name);\r\n+    LOG_DEBUG(\"find : %s\\r\\n\", name);\r\n+    hal_device_t *cur = hdev_list;\r\n+    while (NULL != cur)\r\n+    {\r\n+        LOG_DEBUG(\"|%s| |%s|\\r\\n\",cur->name, name);\r\n+        if(strcmp(cur->name, name) == 0)\r\n+        {\r\n+            LOG_DEBUG(\"===\\r\\n\");\r\n+            return cur;\r\n+        }\r\n+        cur = cur->next;\r\n+    }\r\n+    return NULL;\r\n+}\r\n+\r\n+\r\n+/*\r\n+    驱动读\r\n+*/\r\n+int hal_device_read(hal_device_t *dev,  int pos, void *buffer, int size)\r\n+{\r\n+    HAL_DEV_NULL_CHECK(dev);\r\n+\r\n+    if(dev->dops->read)\r\n+        return dev->dops->read(dev, pos, buffer, size);\r\n+\r\n+    return HAL_ERROR;\r\n+}\r\n+/*\r\n+    驱动写\r\n+*/\r\n+int hal_device_write(hal_device_t *dev, int pos, const void *buffer, int size)\r\n+{\r\n+    HAL_DEV_NULL_CHECK(dev);\r\n+    if(dev->dops->write)\r\n+        return dev->dops->write(dev, pos, buffer, size);\r\n+\r\n+    return HAL_ERROR;\r\n+}\r\n+/*\r\n+    驱动控制\r\n+*/\r\n+int hal_device_ctrl(hal_device_t *dev,  int cmd, void *arg)\r\n+{\r\n+    HAL_DEV_NULL_CHECK(dev);\r\n+    if(dev->dops->control)\r\n+        return dev->dops->control(dev, cmd, arg);\r\n+\r\n+    return HAL_ERROR;\r\n+}\r\n+/*\r\n+    驱动配置\r\n+*/\r\n+int hal_device_cfg(hal_device_t *dev, void *args, void *var)\r\n+{\r\n+    HAL_DEV_NULL_CHECK(dev);\r\n+\r\n+    if(dev->dops->config)\r\n+        return dev->dops->config(dev, args, var);\r\n+\r\n+    return HAL_ERROR;\r\n+}\r\n+\r\n+/*\r\n+    驱动初始化\r\n+*/\r\n+int hal_device_init(hal_device_t *dev)\r\n+{\r\n+    HAL_DEV_NULL_CHECK(dev);\r\n+\r\n+    if(dev->dops->init)\r\n+        return dev->dops->init(dev);\r\n+\r\n+    return HAL_ERROR;\r\n+}\r\n+/*\r\n+    设置驱动属于哪个任务\r\n+*/\r\n+void hal_device_set_owner(hal_device_t *dev, const void *owner)\r\n+{\r\n+    dev->owner = (void *)owner;\r\n+}\r\n+\r\n+\r\n"
                },
                {
                    "date": 1677083532957,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -34,169 +34,10 @@\n         while (cur->next != NULL)\r\n         {\r\n             cur = cur->next;\r\n         }\r\n-        cur\r\n-        \r\n-    }\r\n-\r\n-    \r\n-\r\n-\r\n-    if(NULL == cur)\r\n-    {\r\n         cur = dev;\r\n-        LOG_ERROR(\"%s\\r\\n\", cur->name);\r\n-        cur->next = NULL;\r\n-    }else\r\n-    {\r\n-        while(NULL != cur)\r\n-            cur = cur->next;\r\n-        cur->next = dev;\r\n-        dev->next = NULL;\r\n-        LOG_ERROR(\"%s\\r\\n\", cur->name);\r\n-    }\r\n-    return HAL_OK;\r\n-}\r\n-\r\n-// 驱动注册\r\n-int hal_device_register(hal_device_t *dev)\r\n-{\r\n-    HAL_DEV_NULL_CHECK(dev);\r\n-\r\n-    LOG_DEBUG(\"register : %s\\r\\n\", dev->name);\r\n-\r\n-    // if((NULL==dev->name) || (NULL==dev->dops) || (hal_device_is_exists(dev)==HAL_ERROR))\r\n-    // {\r\n-    //     return HAL_ERROR;\r\n-    // }\r\n-    return hal_device_inster(dev);\r\n-}\r\n-\r\n-hal_device_t *hal_device_find(const char *name)\r\n-{\r\n-    HAL_DEV_NULL_CHECK(name);\r\n-    LOG_DEBUG(\"find : %s\\r\\n\", name);\r\n-    hal_device_t *cur = hdev_list;\r\n-    while (NULL != cur)\r\n-    {\r\n-        LOG_DEBUG(\"|%s| |%s|\\r\\n\",cur->name, name);\r\n-        if(strcmp(cur->name, name) == 0)\r\n-        {\r\n-            LOG_DEBUG(\"===\\r\\n\");\r\n-            return cur;\r\n-        }\r\n-        cur = cur->next;\r\n-    }\r\n-    return NULL;\r\n-}\r\n-\r\n-\r\n-/*\r\n-    驱动读\r\n-*/\r\n-int hal_device_read(hal_device_t *dev,  int pos, void *buffer, int size)\r\n-{\r\n-    HAL_DEV_NULL_CHECK(dev);\r\n-\r\n-    if(dev->dops->read)\r\n-        return dev->dops->read(dev, pos, buffer, size);\r\n-\r\n-    return HAL_ERROR;\r\n-}\r\n-/*\r\n-    驱动写\r\n-*/\r\n-int hal_device_write(hal_device_t *dev, int pos, const void *buffer, int size)\r\n-{\r\n-    HAL_DEV_NULL_CHECK(dev);\r\n-    if(dev->dops->write)\r\n-        return dev->dops->write(dev, pos, buffer, size);\r\n-\r\n-    return HAL_ERROR;\r\n-}\r\n-/*\r\n-    驱动控制\r\n-*/\r\n-int hal_device_ctrl(hal_device_t *dev,  int cmd, void *arg)\r\n-{\r\n-    HAL_DEV_NULL_CHECK(dev);\r\n-    if(dev->dops->control)\r\n-        return dev->dops->control(dev, cmd, arg);\r\n-\r\n-    return HAL_ERROR;\r\n-}\r\n-/*\r\n-    驱动配置\r\n-*/\r\n-int hal_device_cfg(hal_device_t *dev, void *args, void *var)\r\n-{\r\n-    HAL_DEV_NULL_CHECK(dev);\r\n-\r\n-    if(dev->dops->config)\r\n-        return dev->dops->config(dev, args, var);\r\n-\r\n-    return HAL_ERROR;\r\n-}\r\n-\r\n-/*\r\n-    驱动初始化\r\n-*/\r\n-int hal_device_init(hal_device_t *dev)\r\n-{\r\n-    HAL_DEV_NULL_CHECK(dev);\r\n-\r\n-    if(dev->dops->init)\r\n-        return dev->dops->init(dev);\r\n-\r\n-    return HAL_ERROR;\r\n-}\r\n-/*\r\n-    设置驱动属于哪个任务\r\n-*/\r\n-void hal_device_set_owner(hal_device_t *dev, const void *owner)\r\n-{\r\n-    dev->owner = (void *)owner;\r\n-}\r\n-\r\n-\r\n-#include \"hal_device.h\"\r\n-#include <string.h>\r\n-\r\n-static hal_device_t *hdev_list = NULL;\r\n-\r\n-// 查找设备是否存在\r\n-static int hal_device_is_exists(hal_device_t *dev)\r\n-{\r\n-    HAL_DEV_NULL_CHECK(dev);\r\n-    hal_device_t *cur = hdev_list;\r\n-    while (NULL != cur)\r\n-    {\r\n-        if(strcmp(cur->name, dev->name) == 0)\r\n-            return HAL_ERROR;\r\n-        cur = cur->next;\r\n-    }\r\n-    return HAL_OK;\r\n-}\r\n-\r\n-// 插入设备\r\n-static int hal_device_inster(hal_device_t *dev)\r\n-{\r\n-    hal_device_t *cur = hdev_list;\r\n-    if( NULL == dev )\r\n-        return HAL_ERROR;\r\n-\r\n-\r\n-    if( cur == NULL )\r\n-    {\r\n-        cur = dev;\r\n-        cur->next = NULL;\r\n-    }else\r\n-    {\r\n-        while (cur->next != NULL)\r\n-        {\r\n-            cur = cur.\r\n-        }\r\n+        cur.\r\n         \r\n     }\r\n \r\n     \r\n"
                },
                {
                    "date": 1677083539354,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -35,10 +35,9 @@\n         {\r\n             cur = cur->next;\r\n         }\r\n         cur = dev;\r\n-        cur.\r\n-        \r\n+        cur->next = NULL;\r\n     }\r\n \r\n     \r\n \r\n"
                },
                {
                    "date": 1677083636024,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -30,9 +30,9 @@\n         cur = dev;\r\n         cur->next = NULL;\r\n     }else\r\n     {\r\n-        while (cur->next != NULL)\r\n+        while (cur->next)\r\n         {\r\n             cur = cur->next;\r\n         }\r\n         cur = dev;\r\n@@ -41,21 +41,21 @@\n \r\n     \r\n \r\n \r\n-    if(NULL == cur)\r\n-    {\r\n-        cur = dev;\r\n-        LOG_ERROR(\"%s\\r\\n\", cur->name);\r\n-        cur->next = NULL;\r\n-    }else\r\n-    {\r\n-        while(NULL != cur)\r\n-            cur = cur->next;\r\n-        cur->next = dev;\r\n-        dev->next = NULL;\r\n-        LOG_ERROR(\"%s\\r\\n\", cur->name);\r\n-    }\r\n+    // if(NULL == cur)\r\n+    // {\r\n+    //     cur = dev;\r\n+    //     LOG_ERROR(\"%s\\r\\n\", cur->name);\r\n+    //     cur->next = NULL;\r\n+    // }else\r\n+    // {\r\n+    //     while(NULL != cur)\r\n+    //         cur = cur->next;\r\n+    //     cur->next = dev;\r\n+    //     dev->next = NULL;\r\n+    //     LOG_ERROR(\"%s\\r\\n\", cur->name);\r\n+    // }\r\n     return HAL_OK;\r\n }\r\n \r\n // 驱动注册\r\n"
                },
                {
                    "date": 1677083687011,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -23,9 +23,9 @@\n     hal_device_t *cur = hdev_list;\r\n     if( NULL == dev )\r\n         return HAL_ERROR;\r\n \r\n-\r\n+    \r\n     if( cur == NULL )\r\n     {\r\n         cur = dev;\r\n         cur->next = NULL;\r\n"
                },
                {
                    "date": 1677083694619,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -23,12 +23,12 @@\n     hal_device_t *cur = hdev_list;\r\n     if( NULL == dev )\r\n         return HAL_ERROR;\r\n \r\n-    \r\n-    if( cur == NULL )\r\n+\r\n+    if( hdev_list == NULL )\r\n     {\r\n-        cur = dev;\r\n+        hdev_list = dev;\r\n         cur->next = NULL;\r\n     }else\r\n     {\r\n         while (cur->next)\r\n"
                },
                {
                    "date": 1677083702859,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -27,14 +27,14 @@\n \r\n     if( hdev_list == NULL )\r\n     {\r\n         hdev_list = dev;\r\n-        cur->next = NULL;\r\n+        hdev_list->next = NULL;\r\n     }else\r\n     {\r\n-        while (cur->next)\r\n+        while (hdev_list->next)\r\n         {\r\n-            cur = cur->next;\r\n+            hdev_list = cur->next;\r\n         }\r\n         cur = dev;\r\n         cur->next = NULL;\r\n     }\r\n"
                },
                {
                    "date": 1677083710007,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -32,14 +32,16 @@\n     }else\r\n     {\r\n         while (hdev_list->next)\r\n         {\r\n-            hdev_list = cur->next;\r\n+            hdev_list = hdev_list->next;\r\n         }\r\n-        cur = dev;\r\n-        cur->next = NULL;\r\n+        hdev_list = dev;\r\n+        hdev_list->next = NULL;\r\n     }\r\n \r\n+    hdev_list = cur\r\n+\r\n     \r\n \r\n \r\n     // if(NULL == cur)\r\n"
                },
                {
                    "date": 1677083716259,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -27,8 +27,9 @@\n \r\n     if( hdev_list == NULL )\r\n     {\r\n         hdev_list = dev;\r\n+        LOG_ERROR(\"%s\\r\\n\", cur->name);\r\n         hdev_list->next = NULL;\r\n     }else\r\n     {\r\n         while (hdev_list->next)\r\n"
                },
                {
                    "date": 1677083724029,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -27,16 +27,17 @@\n \r\n     if( hdev_list == NULL )\r\n     {\r\n         hdev_list = dev;\r\n-        LOG_ERROR(\"%s\\r\\n\", cur->name);\r\n+        LOG_ERROR(\"%s\\r\\n\", hdev_list->name);\r\n         hdev_list->next = NULL;\r\n     }else\r\n     {\r\n         while (hdev_list->next)\r\n         {\r\n             hdev_list = hdev_list->next;\r\n         }\r\n+        LOG_ERROR(\"%s\\r\\n\", hdev_list->name);\r\n         hdev_list = dev;\r\n         hdev_list->next = NULL;\r\n     }\r\n \r\n"
                },
                {
                    "date": 1677083734861,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,165 @@\n+#include \"hal_device.h\"\r\n+#include <string.h>\r\n+\r\n+static hal_device_t *hdev_list = NULL;\r\n+\r\n+// 查找设备是否存在\r\n+static int hal_device_is_exists(hal_device_t *dev)\r\n+{\r\n+    HAL_DEV_NULL_CHECK(dev);\r\n+    hal_device_t *cur = hdev_list;\r\n+    while (NULL != cur)\r\n+    {\r\n+        if(strcmp(cur->name, dev->name) == 0)\r\n+            return HAL_ERROR;\r\n+        cur = cur->next;\r\n+    }\r\n+    return HAL_OK;\r\n+}\r\n+\r\n+// 插入设备\r\n+static int hal_device_inster(hal_device_t *dev)\r\n+{\r\n+    hal_device_t *cur = hdev_list;\r\n+    if( NULL == dev )\r\n+        return HAL_ERROR;\r\n+\r\n+\r\n+    if( hdev_list == NULL )\r\n+    {\r\n+        hdev_list = dev;\r\n+        hdev_list->next = NULL;\r\n+        LOG_ERROR(\"%s\\r\\n\", hdev_list->name);\r\n+    }else\r\n+    {\r\n+        while (hdev_list->next)\r\n+        {\r\n+            hdev_list = hdev_list->next;\r\n+        }\r\n+        hdev_list = dev;\r\n+        hdev_list->next = NULL;\r\n+        LOG_ERROR(\"%s\\r\\n\", hdev_list->name);\r\n+    }\r\n+\r\n+    hdev_list = cur;\r\n+\r\n+    \r\n+\r\n+\r\n+    // if(NULL == cur)\r\n+    // {\r\n+    //     cur = dev;\r\n+    //     LOG_ERROR(\"%s\\r\\n\", cur->name);\r\n+    //     cur->next = NULL;\r\n+    // }else\r\n+    // {\r\n+    //     while(NULL != cur)\r\n+    //         cur = cur->next;\r\n+    //     cur->next = dev;\r\n+    //     dev->next = NULL;\r\n+    //     LOG_ERROR(\"%s\\r\\n\", cur->name);\r\n+    // }\r\n+    return HAL_OK;\r\n+}\r\n+\r\n+// 驱动注册\r\n+int hal_device_register(hal_device_t *dev)\r\n+{\r\n+    HAL_DEV_NULL_CHECK(dev);\r\n+\r\n+    LOG_DEBUG(\"register : %s\\r\\n\", dev->name);\r\n+\r\n+    // if((NULL==dev->name) || (NULL==dev->dops) || (hal_device_is_exists(dev)==HAL_ERROR))\r\n+    // {\r\n+    //     return HAL_ERROR;\r\n+    // }\r\n+    return hal_device_inster(dev);\r\n+}\r\n+\r\n+hal_device_t *hal_device_find(const char *name)\r\n+{\r\n+    HAL_DEV_NULL_CHECK(name);\r\n+    LOG_DEBUG(\"find : %s\\r\\n\", name);\r\n+    hal_device_t *cur = hdev_list;\r\n+    while (NULL != cur)\r\n+    {\r\n+        LOG_DEBUG(\"|%s| |%s|\\r\\n\",cur->name, name);\r\n+        if(strcmp(cur->name, name) == 0)\r\n+        {\r\n+            LOG_DEBUG(\"===\\r\\n\");\r\n+            return cur;\r\n+        }\r\n+        cur = cur->next;\r\n+    }\r\n+    return NULL;\r\n+}\r\n+\r\n+\r\n+/*\r\n+    驱动读\r\n+*/\r\n+int hal_device_read(hal_device_t *dev,  int pos, void *buffer, int size)\r\n+{\r\n+    HAL_DEV_NULL_CHECK(dev);\r\n+\r\n+    if(dev->dops->read)\r\n+        return dev->dops->read(dev, pos, buffer, size);\r\n+\r\n+    return HAL_ERROR;\r\n+}\r\n+/*\r\n+    驱动写\r\n+*/\r\n+int hal_device_write(hal_device_t *dev, int pos, const void *buffer, int size)\r\n+{\r\n+    HAL_DEV_NULL_CHECK(dev);\r\n+    if(dev->dops->write)\r\n+        return dev->dops->write(dev, pos, buffer, size);\r\n+\r\n+    return HAL_ERROR;\r\n+}\r\n+/*\r\n+    驱动控制\r\n+*/\r\n+int hal_device_ctrl(hal_device_t *dev,  int cmd, void *arg)\r\n+{\r\n+    HAL_DEV_NULL_CHECK(dev);\r\n+    if(dev->dops->control)\r\n+        return dev->dops->control(dev, cmd, arg);\r\n+\r\n+    return HAL_ERROR;\r\n+}\r\n+/*\r\n+    驱动配置\r\n+*/\r\n+int hal_device_cfg(hal_device_t *dev, void *args, void *var)\r\n+{\r\n+    HAL_DEV_NULL_CHECK(dev);\r\n+\r\n+    if(dev->dops->config)\r\n+        return dev->dops->config(dev, args, var);\r\n+\r\n+    return HAL_ERROR;\r\n+}\r\n+\r\n+/*\r\n+    驱动初始化\r\n+*/\r\n+int hal_device_init(hal_device_t *dev)\r\n+{\r\n+    HAL_DEV_NULL_CHECK(dev);\r\n+\r\n+    if(dev->dops->init)\r\n+        return dev->dops->init(dev);\r\n+\r\n+    return HAL_ERROR;\r\n+}\r\n+/*\r\n+    设置驱动属于哪个任务\r\n+*/\r\n+void hal_device_set_owner(hal_device_t *dev, const void *owner)\r\n+{\r\n+    dev->owner = (void *)owner;\r\n+}\r\n+\r\n+\r\n"
                },
                {
                    "date": 1677084001296,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -2,8 +2,10 @@\n #include <string.h>\r\n \r\n static hal_device_t *hdev_list = NULL;\r\n \r\n+static void hal_device_\r\n+\r\n // 查找设备是否存在\r\n static int hal_device_is_exists(hal_device_t *dev)\r\n {\r\n     HAL_DEV_NULL_CHECK(dev);\r\n@@ -162,169 +164,4 @@\n     dev->owner = (void *)owner;\r\n }\r\n \r\n \r\n-#include \"hal_device.h\"\r\n-#include <string.h>\r\n-\r\n-static hal_device_t *hdev_list = NULL;\r\n-\r\n-// 查找设备是否存在\r\n-static int hal_device_is_exists(hal_device_t *dev)\r\n-{\r\n-    HAL_DEV_NULL_CHECK(dev);\r\n-    hal_device_t *cur = hdev_list;\r\n-    while (NULL != cur)\r\n-    {\r\n-        if(strcmp(cur->name, dev->name) == 0)\r\n-            return HAL_ERROR;\r\n-        cur = cur->next;\r\n-    }\r\n-    return HAL_OK;\r\n-}\r\n-\r\n-// 插入设备\r\n-static int hal_device_inster(hal_device_t *dev)\r\n-{\r\n-    hal_device_t *cur = hdev_list;\r\n-    if( NULL == dev )\r\n-        return HAL_ERROR;\r\n-\r\n-\r\n-    if( hdev_list == NULL )\r\n-    {\r\n-        hdev_list = dev;\r\n-        LOG_ERROR(\"%s\\r\\n\", hdev_list->name);\r\n-        hdev_list->next = NULL;\r\n-    }else\r\n-    {\r\n-        while (hdev_list->next)\r\n-        {\r\n-            hdev_list = hdev_list->next;\r\n-        }\r\n-        LOG_ERROR(\"%s\\r\\n\", hdev_list->name);\r\n-        hdev_list = dev;\r\n-        hdev_list->next = NULL;\r\n-    }\r\n-\r\n-    hdev_list = cur\r\n-\r\n-    \r\n-\r\n-\r\n-    // if(NULL == cur)\r\n-    // {\r\n-    //     cur = dev;\r\n-    //     LOG_ERROR(\"%s\\r\\n\", cur->name);\r\n-    //     cur->next = NULL;\r\n-    // }else\r\n-    // {\r\n-    //     while(NULL != cur)\r\n-    //         cur = cur->next;\r\n-    //     cur->next = dev;\r\n-    //     dev->next = NULL;\r\n-    //     LOG_ERROR(\"%s\\r\\n\", cur->name);\r\n-    // }\r\n-    return HAL_OK;\r\n-}\r\n-\r\n-// 驱动注册\r\n-int hal_device_register(hal_device_t *dev)\r\n-{\r\n-    HAL_DEV_NULL_CHECK(dev);\r\n-\r\n-    LOG_DEBUG(\"register : %s\\r\\n\", dev->name);\r\n-\r\n-    // if((NULL==dev->name) || (NULL==dev->dops) || (hal_device_is_exists(dev)==HAL_ERROR))\r\n-    // {\r\n-    //     return HAL_ERROR;\r\n-    // }\r\n-    return hal_device_inster(dev);\r\n-}\r\n-\r\n-hal_device_t *hal_device_find(const char *name)\r\n-{\r\n-    HAL_DEV_NULL_CHECK(name);\r\n-    LOG_DEBUG(\"find : %s\\r\\n\", name);\r\n-    hal_device_t *cur = hdev_list;\r\n-    while (NULL != cur)\r\n-    {\r\n-        LOG_DEBUG(\"|%s| |%s|\\r\\n\",cur->name, name);\r\n-        if(strcmp(cur->name, name) == 0)\r\n-        {\r\n-            LOG_DEBUG(\"===\\r\\n\");\r\n-            return cur;\r\n-        }\r\n-        cur = cur->next;\r\n-    }\r\n-    return NULL;\r\n-}\r\n-\r\n-\r\n-/*\r\n-    驱动读\r\n-*/\r\n-int hal_device_read(hal_device_t *dev,  int pos, void *buffer, int size)\r\n-{\r\n-    HAL_DEV_NULL_CHECK(dev);\r\n-\r\n-    if(dev->dops->read)\r\n-        return dev->dops->read(dev, pos, buffer, size);\r\n-\r\n-    return HAL_ERROR;\r\n-}\r\n-/*\r\n-    驱动写\r\n-*/\r\n-int hal_device_write(hal_device_t *dev, int pos, const void *buffer, int size)\r\n-{\r\n-    HAL_DEV_NULL_CHECK(dev);\r\n-    if(dev->dops->write)\r\n-        return dev->dops->write(dev, pos, buffer, size);\r\n-\r\n-    return HAL_ERROR;\r\n-}\r\n-/*\r\n-    驱动控制\r\n-*/\r\n-int hal_device_ctrl(hal_device_t *dev,  int cmd, void *arg)\r\n-{\r\n-    HAL_DEV_NULL_CHECK(dev);\r\n-    if(dev->dops->control)\r\n-        return dev->dops->control(dev, cmd, arg);\r\n-\r\n-    return HAL_ERROR;\r\n-}\r\n-/*\r\n-    驱动配置\r\n-*/\r\n-int hal_device_cfg(hal_device_t *dev, void *args, void *var)\r\n-{\r\n-    HAL_DEV_NULL_CHECK(dev);\r\n-\r\n-    if(dev->dops->config)\r\n-        return dev->dops->config(dev, args, var);\r\n-\r\n-    return HAL_ERROR;\r\n-}\r\n-\r\n-/*\r\n-    驱动初始化\r\n-*/\r\n-int hal_device_init(hal_device_t *dev)\r\n-{\r\n-    HAL_DEV_NULL_CHECK(dev);\r\n-\r\n-    if(dev->dops->init)\r\n-        return dev->dops->init(dev);\r\n-\r\n-    return HAL_ERROR;\r\n-}\r\n-/*\r\n-    设置驱动属于哪个任务\r\n-*/\r\n-void hal_device_set_owner(hal_device_t *dev, const void *owner)\r\n-{\r\n-    dev->owner = (void *)owner;\r\n-}\r\n-\r\n-\r\n"
                },
                {
                    "date": 1677084009360,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -2,9 +2,16 @@\n #include <string.h>\r\n \r\n static hal_device_t *hdev_list = NULL;\r\n \r\n-static void hal_device_\r\n+static void hal_device_printf()\r\n+{\r\n+    while (/* condition */)\r\n+    {\r\n+        /* code */\r\n+    }\r\n+    \r\n+}\r\n \r\n // 查找设备是否存在\r\n static int hal_device_is_exists(hal_device_t *dev)\r\n {\r\n"
                },
                {
                    "date": 1677084014704,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -4,9 +4,9 @@\n static hal_device_t *hdev_list = NULL;\r\n \r\n static void hal_device_printf()\r\n {\r\n-    while (/* condition */)\r\n+    while (hdev_list)\r\n     {\r\n         /* code */\r\n     }\r\n     \r\n"
                },
                {
                    "date": 1677084020951,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -4,9 +4,9 @@\n static hal_device_t *hdev_list = NULL;\r\n \r\n static void hal_device_printf()\r\n {\r\n-    while (hdev_list)\r\n+    while (hdev_list!)\r\n     {\r\n         /* code */\r\n     }\r\n     \r\n"
                },
                {
                    "date": 1677084029188,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -4,9 +4,11 @@\n static hal_device_t *hdev_list = NULL;\r\n \r\n static void hal_device_printf()\r\n {\r\n-    while (hdev_list!)\r\n+    hal_device_t *cur = hdev_list;\r\n+\r\n+    while (hdev_list!=NULL)\r\n     {\r\n         /* code */\r\n     }\r\n     \r\n"
                },
                {
                    "date": 1677084036165,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -6,11 +6,11 @@\n static void hal_device_printf()\r\n {\r\n     hal_device_t *cur = hdev_list;\r\n \r\n-    while (hdev_list!=NULL)\r\n+    while (cur!=NULL)\r\n     {\r\n-        /* code */\r\n+        p\r\n     }\r\n     \r\n }\r\n \r\n"
                },
                {
                    "date": 1677084042572,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -8,9 +8,9 @@\n     hal_device_t *cur = hdev_list;\r\n \r\n     while (cur!=NULL)\r\n     {\r\n-        p\r\n+        LOG_();\r\n     }\r\n     \r\n }\r\n \r\n"
                },
                {
                    "date": 1677084053234,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -8,9 +8,9 @@\n     hal_device_t *cur = hdev_list;\r\n \r\n     while (cur!=NULL)\r\n     {\r\n-        LOG_();\r\n+        LOG_DEBUG(\"device:\");\r\n     }\r\n     \r\n }\r\n \r\n"
                },
                {
                    "date": 1677084060996,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -5,12 +5,12 @@\n \r\n static void hal_device_printf()\r\n {\r\n     hal_device_t *cur = hdev_list;\r\n-\r\n+    int i=0;\r\n     while (cur!=NULL)\r\n     {\r\n-        LOG_DEBUG(\"device:\");\r\n+        LOG_DEBUG(\"device[%d]:\");\r\n     }\r\n     \r\n }\r\n \r\n"
                },
                {
                    "date": 1677084067315,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -8,9 +8,9 @@\n     hal_device_t *cur = hdev_list;\r\n     int i=0;\r\n     while (cur!=NULL)\r\n     {\r\n-        LOG_DEBUG(\"device[%d]:\");\r\n+        LOG_DEBUG(\"device[%d]:\\r\\n\", i,);\r\n     }\r\n     \r\n }\r\n \r\n"
                },
                {
                    "date": 1677084075216,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -8,9 +8,9 @@\n     hal_device_t *cur = hdev_list;\r\n     int i=0;\r\n     while (cur!=NULL)\r\n     {\r\n-        LOG_DEBUG(\"device[%d]:\\r\\n\", i,);\r\n+        LOG_DEBUG(\"device[%d]:%s\\r\\n\", i,cur);\r\n     }\r\n     \r\n }\r\n \r\n"
                },
                {
                    "date": 1677084081971,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -8,9 +8,10 @@\n     hal_device_t *cur = hdev_list;\r\n     int i=0;\r\n     while (cur!=NULL)\r\n     {\r\n-        LOG_DEBUG(\"device[%d]:%s\\r\\n\", i,cur);\r\n+        LOG_DEBUG(\"device[%d]:%s\\r\\n\", i,cur->name);\r\n+        cur = cur.\r\n     }\r\n     \r\n }\r\n \r\n"
                },
                {
                    "date": 1677084094013,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -9,9 +9,9 @@\n     int i=0;\r\n     while (cur!=NULL)\r\n     {\r\n         LOG_DEBUG(\"device[%d]:%s\\r\\n\", i,cur->name);\r\n-        cur = cur.\r\n+        cur = cur->next;\r\n     }\r\n     \r\n }\r\n \r\n@@ -53,9 +53,9 @@\n         LOG_ERROR(\"%s\\r\\n\", hdev_list->name);\r\n     }\r\n \r\n     hdev_list = cur;\r\n-\r\n+hal_device_printf\r\n     \r\n \r\n \r\n     // if(NULL == cur)\r\n"
                },
                {
                    "date": 1677084138931,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -32,12 +32,9 @@\n // 插入设备\r\n static int hal_device_inster(hal_device_t *dev)\r\n {\r\n     hal_device_t *cur = hdev_list;\r\n-    if( NULL == dev )\r\n-        return HAL_ERROR;\r\n \r\n-\r\n     if( hdev_list == NULL )\r\n     {\r\n         hdev_list = dev;\r\n         hdev_list->next = NULL;\r\n@@ -53,9 +50,9 @@\n         LOG_ERROR(\"%s\\r\\n\", hdev_list->name);\r\n     }\r\n \r\n     hdev_list = cur;\r\n-hal_device_printf\r\n+hal_device_printf();\r\n     \r\n \r\n \r\n     // if(NULL == cur)\r\n"
                },
                {
                    "date": 1677084152216,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -36,9 +36,9 @@\n \r\n     if( hdev_list == NULL )\r\n     {\r\n         hdev_list = dev;\r\n-        hdev_list->next = NULL;\r\n+        dev->next = NULL;\r\n         LOG_ERROR(\"%s\\r\\n\", hdev_list->name);\r\n     }else\r\n     {\r\n         while (hdev_list->next)\r\n"
                },
                {
                    "date": 1677084171273,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -40,11 +40,11 @@\n         dev->next = NULL;\r\n         LOG_ERROR(\"%s\\r\\n\", hdev_list->name);\r\n     }else\r\n     {\r\n-        while (hdev_list->next)\r\n+        while (cur->next)\r\n         {\r\n-            hdev_list = hdev_list->next;\r\n+            cur = hdev_list->next;\r\n         }\r\n         hdev_list = dev;\r\n         hdev_list->next = NULL;\r\n         LOG_ERROR(\"%s\\r\\n\", hdev_list->name);\r\n"
                },
                {
                    "date": 1677084179310,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,173 @@\n+#include \"hal_device.h\"\r\n+#include <string.h>\r\n+\r\n+static hal_device_t *hdev_list = NULL;\r\n+\r\n+static void hal_device_printf()\r\n+{\r\n+    hal_device_t *cur = hdev_list;\r\n+    int i=0;\r\n+    while (cur!=NULL)\r\n+    {\r\n+        LOG_DEBUG(\"device[%d]:%s\\r\\n\", i,cur->name);\r\n+        cur = cur->next;\r\n+    }\r\n+    \r\n+}\r\n+\r\n+// 查找设备是否存在\r\n+static int hal_device_is_exists(hal_device_t *dev)\r\n+{\r\n+    HAL_DEV_NULL_CHECK(dev);\r\n+    hal_device_t *cur = hdev_list;\r\n+    while (NULL != cur)\r\n+    {\r\n+        if(strcmp(cur->name, dev->name) == 0)\r\n+            return HAL_ERROR;\r\n+        cur = cur->next;\r\n+    }\r\n+    return HAL_OK;\r\n+}\r\n+\r\n+// 插入设备\r\n+static int hal_device_inster(hal_device_t *dev)\r\n+{\r\n+    hal_device_t *cur = hdev_list;\r\n+\r\n+    if( hdev_list == NULL )\r\n+    {\r\n+        hdev_list = dev;\r\n+        dev->next = NULL;\r\n+        LOG_ERROR(\"%s\\r\\n\", hdev_list->name);\r\n+    }else\r\n+    {\r\n+        while (cur->next)\r\n+        {\r\n+            cur = cur->next;\r\n+        }\r\n+        cur = dev;\r\n+        cur->next = NULL;\r\n+        LOG_ERROR(\"%s\\r\\n\", cur->name);\r\n+    }\r\n+\r\n+hal_device_printf();\r\n+    \r\n+\r\n+\r\n+    // if(NULL == cur)\r\n+    // {\r\n+    //     cur = dev;\r\n+    //     LOG_ERROR(\"%s\\r\\n\", cur->name);\r\n+    //     cur->next = NULL;\r\n+    // }else\r\n+    // {\r\n+    //     while(NULL != cur)\r\n+    //         cur = cur->next;\r\n+    //     cur->next = dev;\r\n+    //     dev->next = NULL;\r\n+    //     LOG_ERROR(\"%s\\r\\n\", cur->name);\r\n+    // }\r\n+    return HAL_OK;\r\n+}\r\n+\r\n+// 驱动注册\r\n+int hal_device_register(hal_device_t *dev)\r\n+{\r\n+    HAL_DEV_NULL_CHECK(dev);\r\n+\r\n+    LOG_DEBUG(\"register : %s\\r\\n\", dev->name);\r\n+\r\n+    // if((NULL==dev->name) || (NULL==dev->dops) || (hal_device_is_exists(dev)==HAL_ERROR))\r\n+    // {\r\n+    //     return HAL_ERROR;\r\n+    // }\r\n+    return hal_device_inster(dev);\r\n+}\r\n+\r\n+hal_device_t *hal_device_find(const char *name)\r\n+{\r\n+    HAL_DEV_NULL_CHECK(name);\r\n+    LOG_DEBUG(\"find : %s\\r\\n\", name);\r\n+    hal_device_t *cur = hdev_list;\r\n+    while (NULL != cur)\r\n+    {\r\n+        LOG_DEBUG(\"|%s| |%s|\\r\\n\",cur->name, name);\r\n+        if(strcmp(cur->name, name) == 0)\r\n+        {\r\n+            LOG_DEBUG(\"===\\r\\n\");\r\n+            return cur;\r\n+        }\r\n+        cur = cur->next;\r\n+    }\r\n+    return NULL;\r\n+}\r\n+\r\n+\r\n+/*\r\n+    驱动读\r\n+*/\r\n+int hal_device_read(hal_device_t *dev,  int pos, void *buffer, int size)\r\n+{\r\n+    HAL_DEV_NULL_CHECK(dev);\r\n+\r\n+    if(dev->dops->read)\r\n+        return dev->dops->read(dev, pos, buffer, size);\r\n+\r\n+    return HAL_ERROR;\r\n+}\r\n+/*\r\n+    驱动写\r\n+*/\r\n+int hal_device_write(hal_device_t *dev, int pos, const void *buffer, int size)\r\n+{\r\n+    HAL_DEV_NULL_CHECK(dev);\r\n+    if(dev->dops->write)\r\n+        return dev->dops->write(dev, pos, buffer, size);\r\n+\r\n+    return HAL_ERROR;\r\n+}\r\n+/*\r\n+    驱动控制\r\n+*/\r\n+int hal_device_ctrl(hal_device_t *dev,  int cmd, void *arg)\r\n+{\r\n+    HAL_DEV_NULL_CHECK(dev);\r\n+    if(dev->dops->control)\r\n+        return dev->dops->control(dev, cmd, arg);\r\n+\r\n+    return HAL_ERROR;\r\n+}\r\n+/*\r\n+    驱动配置\r\n+*/\r\n+int hal_device_cfg(hal_device_t *dev, void *args, void *var)\r\n+{\r\n+    HAL_DEV_NULL_CHECK(dev);\r\n+\r\n+    if(dev->dops->config)\r\n+        return dev->dops->config(dev, args, var);\r\n+\r\n+    return HAL_ERROR;\r\n+}\r\n+\r\n+/*\r\n+    驱动初始化\r\n+*/\r\n+int hal_device_init(hal_device_t *dev)\r\n+{\r\n+    HAL_DEV_NULL_CHECK(dev);\r\n+\r\n+    if(dev->dops->init)\r\n+        return dev->dops->init(dev);\r\n+\r\n+    return HAL_ERROR;\r\n+}\r\n+/*\r\n+    设置驱动属于哪个任务\r\n+*/\r\n+void hal_device_set_owner(hal_device_t *dev, const void *owner)\r\n+{\r\n+    dev->owner = (void *)owner;\r\n+}\r\n+\r\n+\r\n"
                },
                {
                    "date": 1677084208616,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -33,9 +33,9 @@\n static int hal_device_inster(hal_device_t *dev)\r\n {\r\n     hal_device_t *cur = hdev_list;\r\n \r\n-    if( hdev_list == NULL )\r\n+    if( cur == NULL )\r\n     {\r\n         hdev_list = dev;\r\n         dev->next = NULL;\r\n         LOG_ERROR(\"%s\\r\\n\", hdev_list->name);\r\n@@ -170,178 +170,4 @@\n     dev->owner = (void *)owner;\r\n }\r\n \r\n \r\n-#include \"hal_device.h\"\r\n-#include <string.h>\r\n-\r\n-static hal_device_t *hdev_list = NULL;\r\n-\r\n-static void hal_device_printf()\r\n-{\r\n-    hal_device_t *cur = hdev_list;\r\n-    int i=0;\r\n-    while (cur!=NULL)\r\n-    {\r\n-        LOG_DEBUG(\"device[%d]:%s\\r\\n\", i,cur->name);\r\n-        cur = cur->next;\r\n-    }\r\n-    \r\n-}\r\n-\r\n-// 查找设备是否存在\r\n-static int hal_device_is_exists(hal_device_t *dev)\r\n-{\r\n-    HAL_DEV_NULL_CHECK(dev);\r\n-    hal_device_t *cur = hdev_list;\r\n-    while (NULL != cur)\r\n-    {\r\n-        if(strcmp(cur->name, dev->name) == 0)\r\n-            return HAL_ERROR;\r\n-        cur = cur->next;\r\n-    }\r\n-    return HAL_OK;\r\n-}\r\n-\r\n-// 插入设备\r\n-static int hal_device_inster(hal_device_t *dev)\r\n-{\r\n-    hal_device_t *cur = hdev_list;\r\n-\r\n-    if( hdev_list == NULL )\r\n-    {\r\n-        hdev_list = dev;\r\n-        dev->next = NULL;\r\n-        LOG_ERROR(\"%s\\r\\n\", hdev_list->name);\r\n-    }else\r\n-    {\r\n-        while (cur->next)\r\n-        {\r\n-            cur = hdev_list->next;\r\n-        }\r\n-        hdev_list = dev;\r\n-        hdev_list->next = NULL;\r\n-        LOG_ERROR(\"%s\\r\\n\", hdev_list->name);\r\n-    }\r\n-\r\n-    hdev_list = cur;\r\n-hal_device_printf();\r\n-    \r\n-\r\n-\r\n-    // if(NULL == cur)\r\n-    // {\r\n-    //     cur = dev;\r\n-    //     LOG_ERROR(\"%s\\r\\n\", cur->name);\r\n-    //     cur->next = NULL;\r\n-    // }else\r\n-    // {\r\n-    //     while(NULL != cur)\r\n-    //         cur = cur->next;\r\n-    //     cur->next = dev;\r\n-    //     dev->next = NULL;\r\n-    //     LOG_ERROR(\"%s\\r\\n\", cur->name);\r\n-    // }\r\n-    return HAL_OK;\r\n-}\r\n-\r\n-// 驱动注册\r\n-int hal_device_register(hal_device_t *dev)\r\n-{\r\n-    HAL_DEV_NULL_CHECK(dev);\r\n-\r\n-    LOG_DEBUG(\"register : %s\\r\\n\", dev->name);\r\n-\r\n-    // if((NULL==dev->name) || (NULL==dev->dops) || (hal_device_is_exists(dev)==HAL_ERROR))\r\n-    // {\r\n-    //     return HAL_ERROR;\r\n-    // }\r\n-    return hal_device_inster(dev);\r\n-}\r\n-\r\n-hal_device_t *hal_device_find(const char *name)\r\n-{\r\n-    HAL_DEV_NULL_CHECK(name);\r\n-    LOG_DEBUG(\"find : %s\\r\\n\", name);\r\n-    hal_device_t *cur = hdev_list;\r\n-    while (NULL != cur)\r\n-    {\r\n-        LOG_DEBUG(\"|%s| |%s|\\r\\n\",cur->name, name);\r\n-        if(strcmp(cur->name, name) == 0)\r\n-        {\r\n-            LOG_DEBUG(\"===\\r\\n\");\r\n-            return cur;\r\n-        }\r\n-        cur = cur->next;\r\n-    }\r\n-    return NULL;\r\n-}\r\n-\r\n-\r\n-/*\r\n-    驱动读\r\n-*/\r\n-int hal_device_read(hal_device_t *dev,  int pos, void *buffer, int size)\r\n-{\r\n-    HAL_DEV_NULL_CHECK(dev);\r\n-\r\n-    if(dev->dops->read)\r\n-        return dev->dops->read(dev, pos, buffer, size);\r\n-\r\n-    return HAL_ERROR;\r\n-}\r\n-/*\r\n-    驱动写\r\n-*/\r\n-int hal_device_write(hal_device_t *dev, int pos, const void *buffer, int size)\r\n-{\r\n-    HAL_DEV_NULL_CHECK(dev);\r\n-    if(dev->dops->write)\r\n-        return dev->dops->write(dev, pos, buffer, size);\r\n-\r\n-    return HAL_ERROR;\r\n-}\r\n-/*\r\n-    驱动控制\r\n-*/\r\n-int hal_device_ctrl(hal_device_t *dev,  int cmd, void *arg)\r\n-{\r\n-    HAL_DEV_NULL_CHECK(dev);\r\n-    if(dev->dops->control)\r\n-        return dev->dops->control(dev, cmd, arg);\r\n-\r\n-    return HAL_ERROR;\r\n-}\r\n-/*\r\n-    驱动配置\r\n-*/\r\n-int hal_device_cfg(hal_device_t *dev, void *args, void *var)\r\n-{\r\n-    HAL_DEV_NULL_CHECK(dev);\r\n-\r\n-    if(dev->dops->config)\r\n-        return dev->dops->config(dev, args, var);\r\n-\r\n-    return HAL_ERROR;\r\n-}\r\n-\r\n-/*\r\n-    驱动初始化\r\n-*/\r\n-int hal_device_init(hal_device_t *dev)\r\n-{\r\n-    HAL_DEV_NULL_CHECK(dev);\r\n-\r\n-    if(dev->dops->init)\r\n-        return dev->dops->init(dev);\r\n-\r\n-    return HAL_ERROR;\r\n-}\r\n-/*\r\n-    设置驱动属于哪个任务\r\n-*/\r\n-void hal_device_set_owner(hal_device_t *dev, const void *owner)\r\n-{\r\n-    dev->owner = (void *)owner;\r\n-}\r\n-\r\n-\r\n"
                }
            ],
            "date": 1677078341030,
            "name": "Commit-0",
            "content": "#include \"hal_device.h\"\r\n#include <string.h>\r\n\r\nhal_device_t *hdev_list = NULL;\r\n\r\n// 查找设备是否存在\r\nstatic int hal_device_is_exists(hal_device_t *dev)\r\n{\r\n    HAL_DEV_NULL_CHECK(dev);\r\n    hal_device_t *cur = hdev_list;\r\n    while (NULL != cur)\r\n    {\r\n        if(stecmp(cur->name, dev->name) == 0)\r\n            return HAL_ERROR;\r\n        cur = cur->next;\r\n    }\r\n    return HAL_OK;\r\n}\r\n\r\n// 插入设备\r\nstatic int hal_device_inster(hal_device_t *dev)\r\n{\r\n    hal_device_t *cur = hdev_list;\r\n    if( NULL == dev )\r\n        return HAL_ERROR;\r\n    if(NULL == cur)\r\n    {\r\n        hdev_list = dev;\r\n        hdev_list->next = NULL;\r\n    }else\r\n    {\r\n        while(NULL != cur)\r\n            cur = cur->next;\r\n        cur->next = dev;\r\n        dev->next = NULL;\r\n    }\r\n    return HAL_OK;\r\n}\r\n\r\n// 驱动注册\r\nint hal_device_register(hal_device_t *dev)\r\n{\r\n    HAL_DEV_NULL_CHECK(dev);\r\n\r\n    if((NULL==dev->name) || (NULL==dev->dops) || (hal_device_is_exists(dev)==HAL_ERROR))\r\n    {\r\n        return HAL_ERROR;\r\n    }\r\n    return hal_device_inster(dev);\r\n}\r\n\r\nhal_device_t *hal_device_find(const char *name)\r\n{\r\n    HAL_DEV_NULL_CHECK(name);\r\n    hal_device_t *cur = hdev_list;\r\n    while (NULL != cur)\r\n    {\r\n        if(strcmp(cur->name, name) == 0)\r\n            return cur;\r\n        cur = cur->next;\r\n    }\r\n    return NULL;\r\n}\r\n\r\n\r\n/*\r\n    驱动读\r\n*/\r\nint hal_device_read(hal_device_t *dev,  int pos, void *buffer, int size)\r\n{\r\n    HAL_DEV_NULL_CHECK(dev);\r\n\r\n    if(dev->dops->read)\r\n        return dev->dops->read(dev, pos, buffer, size);\r\n\r\n    return HAL_ERROR;\r\n}\r\n/*\r\n    驱动写\r\n*/\r\nint hal_device_write(hal_device_t *dev, int pos, const void *buffer, int size)\r\n{\r\n    HAL_DEV_NULL_CHECK(dev);\r\n    if(dev->dops->write)\r\n        return dev->dops->write(dev, pos, buffer, size);\r\n\r\n    return HAL_ERROR;\r\n}\r\n/*\r\n    驱动控制\r\n*/\r\nint hal_device_ctrl(hal_device_t *dev,  int cmd, void *arg)\r\n{\r\n    HAL_DEV_NULL_CHECK(dev);\r\n    if(dev->dops->control)\r\n        return dev->dops->control(dev, cmd, arg);\r\n\r\n    return HAL_ERROR;\r\n}\r\n/*\r\n    驱动配置\r\n*/\r\nint hal_device_cfg(hal_device_t *dev, void *args, void *var)\r\n{\r\n    HAL_DEV_NULL_CHECK(dev);\r\n\r\n    if(dev->dops->config)\r\n        return dev->dops->config(dev, args, var);\r\n\r\n    return HAL_ERROR;\r\n}\r\n/*\r\n    驱动配置\r\n*/\r\nint hal_device_cfg(hal_device_t *dev, void *args, void *var)\r\n{\r\n    HAL_DEV_NULL_CHECK(dev);\r\n\r\n    if(dev->dops->config)\r\n        return dev->dops->config(dev, args, var);\r\n\r\n    return HAL_ERROR;\r\n}\r\n/*\r\n    设置驱动属于哪个任务\r\n*/\r\nvoid hal_device_set_owner(hal_device_t *dev, const void *owner)\r\n{\r\n    dev->owner = (void *)owner;\r\n}\r\n\r\n\r\n"
        }
    ]
}